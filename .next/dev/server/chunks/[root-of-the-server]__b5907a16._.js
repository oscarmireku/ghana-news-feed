module.exports = [
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/node:stream [external] (node:stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:stream", () => require("node:stream"));

module.exports = mod;
}),
"[externals]/buffer [external] (buffer, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}),
"[externals]/string_decoder [external] (string_decoder, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("string_decoder", () => require("string_decoder"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/node:assert [external] (node:assert, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:assert", () => require("node:assert"));

module.exports = mod;
}),
"[externals]/node:net [external] (node:net, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:net", () => require("node:net"));

module.exports = mod;
}),
"[externals]/node:http [external] (node:http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:http", () => require("node:http"));

module.exports = mod;
}),
"[externals]/node:querystring [external] (node:querystring, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:querystring", () => require("node:querystring"));

module.exports = mod;
}),
"[externals]/node:events [external] (node:events, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:events", () => require("node:events"));

module.exports = mod;
}),
"[externals]/node:diagnostics_channel [external] (node:diagnostics_channel, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:diagnostics_channel", () => require("node:diagnostics_channel"));

module.exports = mod;
}),
"[externals]/node:util [external] (node:util, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:util", () => require("node:util"));

module.exports = mod;
}),
"[externals]/node:tls [external] (node:tls, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:tls", () => require("node:tls"));

module.exports = mod;
}),
"[externals]/node:buffer [external] (node:buffer, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:buffer", () => require("node:buffer"));

module.exports = mod;
}),
"[externals]/node:zlib [external] (node:zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:zlib", () => require("node:zlib"));

module.exports = mod;
}),
"[externals]/node:perf_hooks [external] (node:perf_hooks, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:perf_hooks", () => require("node:perf_hooks"));

module.exports = mod;
}),
"[externals]/node:util/types [external] (node:util/types, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:util/types", () => require("node:util/types"));

module.exports = mod;
}),
"[externals]/node:crypto [external] (node:crypto, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:crypto", () => require("node:crypto"));

module.exports = mod;
}),
"[externals]/node:worker_threads [external] (node:worker_threads, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:worker_threads", () => require("node:worker_threads"));

module.exports = mod;
}),
"[externals]/node:http2 [external] (node:http2, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:http2", () => require("node:http2"));

module.exports = mod;
}),
"[externals]/node:async_hooks [external] (node:async_hooks, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:async_hooks", () => require("node:async_hooks"));

module.exports = mod;
}),
"[externals]/node:console [external] (node:console, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:console", () => require("node:console"));

module.exports = mod;
}),
"[externals]/node:fs/promises [external] (node:fs/promises, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:fs/promises", () => require("node:fs/promises"));

module.exports = mod;
}),
"[externals]/node:path [external] (node:path, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:path", () => require("node:path"));

module.exports = mod;
}),
"[externals]/node:timers [external] (node:timers, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:timers", () => require("node:timers"));

module.exports = mod;
}),
"[externals]/node:dns [external] (node:dns, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:dns", () => require("node:dns"));

module.exports = mod;
}),
"[externals]/fs [external] (fs, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}),
"[externals]/path [external] (path, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}),
"[externals]/events [external] (events, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}),
"[externals]/https [external] (https, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}),
"[externals]/http [external] (http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}),
"[externals]/net [external] (net, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}),
"[externals]/tls [external] (tls, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}),
"[externals]/crypto [external] (crypto, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}),
"[externals]/url [external] (url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}),
"[externals]/zlib [external] (zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}),
"[externals]/os [external] (os, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}),
"[project]/news/src/lib/db.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "getAllArticles",
    ()=>getAllArticles,
    "getArticleByLink",
    ()=>getArticleByLink,
    "getArticleCount",
    ()=>getArticleCount,
    "insertArticle",
    ()=>insertArticle,
    "insertArticles",
    ()=>insertArticles,
    "seedArticleTable",
    ()=>seedArticleTable
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f40$vercel$2f$postgres$2f$dist$2f$index$2d$node$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/news/node_modules/@vercel/postgres/dist/index-node.js [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f40$vercel$2f$postgres$2f$dist$2f$chunk$2d$7IR77QAQ$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/news/node_modules/@vercel/postgres/dist/chunk-7IR77QAQ.js [app-route] (ecmascript) <locals>");
;
async function seedArticleTable() {
    await __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f40$vercel$2f$postgres$2f$dist$2f$chunk$2d$7IR77QAQ$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["sql"]`
    CREATE TABLE IF NOT EXISTS articles (
        id TEXT PRIMARY KEY,
        source TEXT NOT NULL,
        title TEXT NOT NULL,
        link TEXT UNIQUE NOT NULL,
        image TEXT,
        time TEXT NOT NULL,
        section TEXT NOT NULL,
        timestamp BIGINT NOT NULL,
        created_at BIGINT NOT NULL,
        content TEXT
    );
    `;
    // Indexes
    await __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f40$vercel$2f$postgres$2f$dist$2f$chunk$2d$7IR77QAQ$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["sql"]`CREATE INDEX IF NOT EXISTS idx_timestamp ON articles(timestamp DESC);`;
    await __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f40$vercel$2f$postgres$2f$dist$2f$chunk$2d$7IR77QAQ$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["sql"]`CREATE INDEX IF NOT EXISTS idx_link ON articles(link);`; // Unique constraint creates index implicitly but this is fine
}
async function insertArticle(article) {
    try {
        const result = await __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f40$vercel$2f$postgres$2f$dist$2f$chunk$2d$7IR77QAQ$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["sql"]`
        INSERT INTO articles (id, source, title, link, image, time, section, timestamp, created_at, content)
        VALUES (${article.id}, ${article.source}, ${article.title}, ${article.link}, ${article.image}, ${article.time}, ${article.section}, ${article.timestamp}, ${Date.now()}, ${article.content || null})
        ON CONFLICT(link) DO UPDATE SET
          time = EXCLUDED.time,
          timestamp = EXCLUDED.timestamp,
          image = EXCLUDED.image,
          title = EXCLUDED.title,
          content = CASE WHEN EXCLUDED.content IS NOT NULL THEN EXCLUDED.content ELSE articles.content END
      `;
        return (result.rowCount ?? 0) > 0;
    } catch (error) {
        console.error('Failed to insert article:', error);
        return false;
    }
}
async function insertArticles(articles) {
    let count = 0;
    // Batch processing could be better, but sequential is safer for now with small batches
    // TODO: Optimise to single INSERT statement for performance if needed
    for (const article of articles){
        const success = await insertArticle(article);
        if (success) count++;
    }
    return count;
}
async function getAllArticles(limit = 100) {
    const { rows } = await __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f40$vercel$2f$postgres$2f$dist$2f$chunk$2d$7IR77QAQ$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["sql"]`
    SELECT id, source, title, link, image, time, section, timestamp, content
    FROM articles
    WHERE image IS NOT NULL AND image != ''
    ORDER BY timestamp DESC
    LIMIT ${limit}
  `;
    // Convert BigInt to number for JS compatibility
    return rows.map((row)=>({
            ...row,
            timestamp: Number(row.timestamp),
            created_at: Number(row.created_at)
        }));
}
async function getArticleByLink(link) {
    const { rows } = await __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f40$vercel$2f$postgres$2f$dist$2f$chunk$2d$7IR77QAQ$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["sql"]`
    SELECT id, source, title, link, image, time, section, timestamp, content
    FROM articles
    WHERE link = ${link}
  `;
    if (rows.length === 0) return undefined;
    const row = rows[0];
    return {
        ...row,
        timestamp: Number(row.timestamp),
        created_at: Number(row.created_at)
    };
}
async function getArticleCount() {
    const { rows } = await __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f40$vercel$2f$postgres$2f$dist$2f$chunk$2d$7IR77QAQ$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["sql"]`SELECT COUNT(*) as count FROM articles`;
    return Number(rows[0].count);
}
}),
"[project]/news/src/app/api/news/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "GET",
    ()=>GET,
    "dynamic",
    ()=>dynamic
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/news/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/news/node_modules/cheerio/dist/esm/index.js [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$load$2d$parse$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/news/node_modules/cheerio/dist/esm/load-parse.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/fs [external] (fs, cjs)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/path [external] (path, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$src$2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/news/src/lib/db.ts [app-route] (ecmascript)");
;
;
;
;
;
const dynamic = 'force-dynamic';
// ---------------------------------------------------------------------------
// Helpers
// ---------------------------------------------------------------------------
function normalizeTitle(title) {
    return title.toLowerCase().replace(/[^a-z0-9]/g, '');
}
function resolveUrl(base, relative) {
    try {
        return new URL(relative, base).href;
    } catch  {
        return relative;
    }
}
// Parse publication date from various formats
function parsePublicationDate(dateStr) {
    if (!dateStr || dateStr.trim() === '') {
        return {
            timestamp: Date.now(),
            display: 'Recent'
        };
    }
    const cleaned = dateStr.trim();
    const d = new Date(cleaned);
    if (!isNaN(d.getTime())) {
        const timestamp = d.getTime();
        const display = d.toLocaleString('en-US', {
            hour: 'numeric',
            minute: '2-digit',
            month: 'short',
            day: 'numeric'
        });
        return {
            timestamp,
            display
        };
    }
    // If we can't parse it, return current time
    return {
        timestamp: Date.now(),
        display: 'Recent'
    };
}
// Fallback: Fetch article page to find og:image and parsing date
async function fetchArticleMetadata(link, source) {
    try {
        const res = await fetch(link, {
            headers: {
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
            }
        });
        if (!res.ok) return {
            image: null
        };
        const html = await res.text();
        const $ = __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$load$2d$parse$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["load"](html);
        // Image
        const image = $('meta[property="og:image"]').attr('content') || $('meta[name="twitter:image"]').attr('content') || null;
        // Date
        let dateStr = $('meta[property="og:article:published_time"]').attr('content') || $('meta[property="article:published_time"]').attr('content') || $('meta[name="article:published_time"]').attr('content') || $('meta[property="og:updated_time"]').attr('content') || $('meta[property="article:modified_time"]').attr('content') || $('meta[itemprop="datePublished"]').attr('content') || $('meta[name="pubdate"]').attr('content') || $('#date').text() || $('time').first().attr('datetime');
        let timestamp;
        let time;
        if (dateStr) {
            const parsed = parsePublicationDate(dateStr);
            if (parsed.display !== 'Recent') {
                timestamp = parsed.timestamp;
                time = parsed.display;
            }
        }
        // Content Extraction
        let contentSelector = '';
        if (source === '3News') contentSelector = '.prose';
        else if (source === 'GhanaWeb') contentSelector = '#medsection1, .article-content-area';
        else if (source === 'AdomOnline') contentSelector = '.td-post-content';
        else if (source === 'MyJoyOnline') contentSelector = '#article-text';
        // Generic fallback selectors
        if (!contentSelector) {
            contentSelector = '.entry-content, .article-body, .post-content, .content-wrapper, article';
        }
        let contentEl = $(contentSelector).first();
        if (contentEl.length === 0 && source === 'GhanaWeb') {
            // Fallback for GhanaWeb
            contentEl = $('p').parent().filter((i, el)=>$(el).find('p').length > 3).first();
        }
        let content = '';
        if (contentEl.length) {
            // Remove unwanted elements
            contentEl.find('script, style, iframe, .related-posts, .ads, .ad, [class*="ad-"], [id*="ad-"]').remove();
            // Get paragraphs
            const paragraphs = [];
            contentEl.find('p').each((_, el)=>{
                const text = $(el).text().trim();
                if (text.length > 20) {
                    paragraphs.push(`<p>${text}</p>`);
                }
            });
            content = paragraphs.join('');
        }
        return {
            image,
            timestamp,
            time,
            content
        };
    } catch  {
        return {
            image: null
        };
    }
}
// ---------------------------------------------------------------------------
// Source: GhanaWeb (Scrape Sections)
// ---------------------------------------------------------------------------
async function scrapeGhanaWeb() {
    const sections = [
        {
            name: 'News',
            url: 'https://www.ghanaweb.com/GhanaHomePage/NewsArchive/'
        },
        {
            name: 'Sports',
            url: 'https://www.ghanaweb.com/GhanaHomePage/SportsArchive/'
        },
        {
            name: 'Business',
            url: 'https://www.ghanaweb.com/GhanaHomePage/business/'
        }
    ];
    const stories = [];
    const seenLinks = new Set();
    await Promise.all(sections.map(async (sec)=>{
        try {
            const res = await fetch(sec.url, {
                headers: {
                    'User-Agent': 'Mozilla/5.0'
                }
            });
            const html = await res.text();
            const $ = __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$load$2d$parse$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["load"](html);
            // Strategy: 
            // 1. Try known containers (desktop view)
            // 2. Fallback: Find ALL links that look like articles in this section
            let candidates = $('.inner-lead, .sub-menu-list__news li, .news_listing .inner, #leads .inner, .news-list li');
            if (candidates.length === 0) {
                // Fallback: finding any link containing 'Article' or looking like a news path
                // GhanaWeb articles: /GhanaHomePage/NewsArchive/artikel.php?ID=... or similar slugs
                candidates = $('a[href*="artikel.php"], a[href*="/NewsArchive/"], a[href*="/SportsArchive/"], a[href*="/business/"]');
            }
            candidates.slice(0, 10).each((_, el)=>{
                const a = $(el).is('a') ? $(el) : $(el).find('a').first();
                const link = a.attr('href');
                let title = a.attr('title') || a.text().trim();
                if (!title || title.length < 5) {
                    title = $(el).find('h2, h3, h4, p').text().trim();
                }
                let image = $(el).find('img').attr('src');
                if (!image) {
                    // Check parent for image
                    image = $(el).closest('div, li').find('img').attr('src');
                }
                // Extract publication date - GhanaWeb typically has date in .date, .time, or time elements
                let dateStr = $(el).find('.date, .time, time, .published, .post-date').first().text().trim();
                if (!dateStr) {
                    // Check for datetime attribute in time element
                    dateStr = $(el).find('time').attr('datetime') || '';
                }
                const { timestamp, display } = parsePublicationDate(dateStr);
                if (link && title && title.length > 10 && !link.includes('javascript') && !link.includes('#')) {
                    const fullLink = resolveUrl('https://www.ghanaweb.com', link);
                    if (seenLinks.has(fullLink)) return;
                    seenLinks.add(fullLink);
                    if (image) image = resolveUrl('https://cdn.ghanaweb.com', image);
                    stories.push({
                        id: `gw-${stories.length + Math.random()}`,
                        source: 'GhanaWeb',
                        title,
                        link: fullLink,
                        image: image || null,
                        time: display,
                        timestamp,
                        section: sec.name
                    });
                }
            });
        } catch (e) {
            console.error(`GhanaWeb ${sec.name} Error:`, e);
        }
    }));
    return stories;
}
// ---------------------------------------------------------------------------
// Source: AdomOnline (RSS Sections)
// ---------------------------------------------------------------------------
async function scrapeAdomOnline() {
    const feeds = [
        {
            name: 'News',
            url: 'https://www.adomonline.com/category/news/feed/'
        },
        {
            name: 'Sports',
            url: 'https://www.adomonline.com/category/sports/feed/'
        },
        {
            name: 'Business',
            url: 'https://www.adomonline.com/category/business/feed/'
        }
    ];
    const stories = [];
    const seenLinks = new Set();
    await Promise.all(feeds.map(async (feed)=>{
        try {
            const res = await fetch(feed.url, {
                headers: {
                    'User-Agent': 'Mozilla/5.0'
                }
            });
            const xml = await res.text();
            const $ = __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$load$2d$parse$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["load"](xml, {
                xmlMode: true
            });
            $('item').slice(0, 5).each((_, el)=>{
                const title = $(el).find('title').text().trim();
                const link = $(el).find('link').text().trim();
                const pubDate = $(el).find('pubDate').text().trim();
                if (seenLinks.has(link)) return;
                seenLinks.add(link);
                let timestamp = Date.now();
                let timeDisplay = 'Recent';
                if (pubDate) {
                    const d = new Date(pubDate);
                    if (!isNaN(d.getTime())) {
                        timestamp = d.getTime();
                        timeDisplay = d.toLocaleString('en-US', {
                            hour: 'numeric',
                            minute: '2-digit',
                            month: 'short',
                            day: 'numeric'
                        });
                    }
                }
                let image = $(el).find('media\\:content').attr('url') || $(el).find('media\\:thumbnail').attr('url');
                if (!image) {
                    const content = $(el).find('content\\:encoded').text();
                    const match = content.match(/src="([^"]+)"/);
                    if (match) image = match[1];
                }
                stories.push({
                    id: `adom-${stories.length + Math.random()}`,
                    source: 'AdomOnline',
                    title,
                    link,
                    image: image || null,
                    time: timeDisplay,
                    timestamp,
                    section: feed.name
                });
            });
        } catch (e) {
            console.error(`AdomOnline ${feed.name} Error:`, e);
        }
    }));
    return stories;
}
// ---------------------------------------------------------------------------
// Source: PeaceFM (HTML Scrape Sections)
// ---------------------------------------------------------------------------
async function scrapePeaceFM() {
    const sections = [
        {
            name: 'News',
            url: 'https://www.peacefmonline.com/pages/local/'
        },
        {
            name: 'Sports',
            url: 'https://www.peacefmonline.com/pages/sports/'
        },
        {
            name: 'Business',
            url: 'https://www.peacefmonline.com/pages/business/'
        }
    ];
    const stories = [];
    const seenLinks = new Set();
    await Promise.all(sections.map(async (sec)=>{
        try {
            const res = await fetch(sec.url, {
                headers: {
                    'User-Agent': 'Mozilla/5.0'
                }
            });
            const html = await res.text();
            const $ = __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$load$2d$parse$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["load"](html);
            // Try generic containers
            let candidates = $('.jeg_post, .post-item, .article-item, .jeg_pl_md_box, .content-wrapper .item');
            // If empty, brute force search for article links in main area. 
            // PeaceFM links start with /pages/ or /article/
            if (candidates.length === 0) {
                candidates = $('a[href^="/article/"], a[href*="/pages/news/"], a[href*="/pages/sports/"], a[href*="/pages/business/"]');
            }
            candidates.slice(0, 10).each((_, el)=>{
                let a = $(el).is('a') ? $(el) : $(el).find('a').first();
                const titleLink = $(el).find('.jeg_post_title a, h2 a, h3 a').first();
                if (titleLink.length) a = titleLink;
                const link = a.attr('href');
                let title = a.text().trim();
                // Image
                let image = $(el).find('img').attr('data-src') || $(el).find('img').attr('src');
                if (!image) {
                    image = $(el).closest('div, li').find('img').first().attr('src');
                }
                // Extract publication date - PeaceFM typically has date in .jeg_meta_date or time elements
                let dateStr = $(el).find('.jeg_meta_date, .date, time, .published, .post-date').first().text().trim();
                if (!dateStr) {
                    dateStr = $(el).find('time').attr('datetime') || '';
                }
                const { timestamp, display } = parsePublicationDate(dateStr);
                // Filter out non-article links if brute forcing (basic heuristic)
                // PeaceFM usually contains 'pages' or 'article'
                if (link && (link.includes('/article/') || link.includes('/pages/')) && title && title.length > 10) {
                    const fullLink = resolveUrl('https://www.peacefmonline.com', link);
                    if (seenLinks.has(fullLink)) return;
                    seenLinks.add(fullLink);
                    if (image) image = resolveUrl('https://www.peacefmonline.com', image);
                    stories.push({
                        id: `peace-${stories.length + Math.random()}`,
                        source: 'PeaceFM',
                        title,
                        link: fullLink,
                        image: image || null,
                        time: display,
                        timestamp,
                        section: sec.name
                    });
                }
            });
        } catch (e) {
            console.error(`PeaceFM ${sec.name} Error:`, e);
        }
    }));
    return stories;
}
// ---------------------------------------------------------------------------
// Source: MyJoyOnline (HTML Scrape Sections)
// ---------------------------------------------------------------------------
async function scrapeMyJoyOnline() {
    const sections = [
        {
            name: 'News',
            url: 'https://www.myjoyonline.com/news/'
        },
        {
            name: 'Sports',
            url: 'https://www.myjoyonline.com/sports/'
        },
        {
            name: 'Business',
            url: 'https://www.myjoyonline.com/business/'
        }
    ];
    const stories = [];
    const seenLinks = new Set();
    await Promise.all(sections.map(async (sec)=>{
        try {
            const res = await fetch(sec.url, {
                headers: {
                    'User-Agent': 'Mozilla/5.0'
                }
            });
            const html = await res.text();
            const $ = __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$load$2d$parse$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["load"](html);
            // Structure: divs containing .bgposition (image link) and .title (text link)
            // or just iterate .col-xs-6, .col-lg-3 containers
            const containers = $('.news-main-list .col-lg-3, .col-lg-6, .home-section-story-list li, .main-listing-article');
            containers.slice(0, 10).each((_, el)=>{
                const imgLink = $(el).find('a.bgposition');
                const titleLink = $(el).find('h3 a, h4 a, .title a').first();
                const fallbackLink = $(el).find('a').first();
                const finalLink = titleLink.length ? titleLink : imgLink.length ? imgLink : fallbackLink;
                const link = finalLink.attr('href');
                let title = finalLink.text().trim();
                // If title was empty from link, try finding header text
                if (!title) title = $(el).find('h1, h2, h3, h4').text().trim();
                let image = $(el).find('img').attr('data-src') || $(el).find('img').attr('src');
                // Extract from style if bgposition
                if (!image && imgLink.attr('style')) {
                    const match = imgLink.attr('style')?.match(/url\(['"]?([^'"]+)['"]?\)/);
                    if (match) image = match[1];
                }
                // Extract publication date - MyJoyOnline typically has date in .date, time, or .post-date
                let dateStr = $(el).find('.date, time, .post-date, .published, .entry-date').first().text().trim();
                if (!dateStr) {
                    dateStr = $(el).find('time').attr('datetime') || '';
                }
                const { timestamp, display } = parsePublicationDate(dateStr);
                if (link && title && title.length > 10) {
                    const fullLink = resolveUrl('https://www.myjoyonline.com', link);
                    if (seenLinks.has(fullLink)) return;
                    seenLinks.add(fullLink);
                    stories.push({
                        id: `joy-${stories.length + Math.random()}`,
                        source: 'MyJoyOnline',
                        title,
                        link: fullLink,
                        image: image || null,
                        time: display,
                        timestamp,
                        section: sec.name
                    });
                }
            });
        } catch (e) {
            console.error(`MyJoyOnline ${sec.name} Error:`, e);
        }
    }));
    return stories;
}
// ---------------------------------------------------------------------------
// Source: 3News (RSS Feed)
// ---------------------------------------------------------------------------
async function scrape3News() {
    const stories = [];
    const seenLinks = new Set();
    try {
        const res = await fetch('https://3news.com/news/feed.xml', {
            headers: {
                'User-Agent': 'Mozilla/5.0'
            }
        });
        if (!res.ok) throw new Error(`3News RSS failed: ${res.status}`);
        const xml = await res.text();
        const $ = __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$load$2d$parse$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["load"](xml, {
            xmlMode: true
        });
        $('item').slice(0, 10).each((_, el)=>{
            const title = $(el).find('title').text().trim();
            const link = $(el).find('link').text().trim();
            const pubDate = $(el).find('pubDate').text().trim();
            if (seenLinks.has(link)) return;
            seenLinks.add(link);
            let timestamp = Date.now();
            let timeDisplay = 'Recent';
            if (pubDate) {
                const parsed = parsePublicationDate(pubDate);
                timestamp = parsed.timestamp;
                timeDisplay = parsed.display;
            }
            // Extract image from media:content or description
            let image = $(el).find('media\\:content').attr('url') || $(el).find('media\\:thumbnail').attr('url');
            if (!image) {
                const description = $(el).find('description').text();
                const match = description.match(/src="([^"]+)"/);
                if (match) image = match[1];
            }
            stories.push({
                id: `3news-${stories.length + Math.random()}`,
                source: '3News',
                title,
                link,
                image: image || null,
                time: timeDisplay,
                timestamp,
                section: 'News'
            });
        });
    } catch (e) {
        console.error('3News Error:', e);
    }
    return stories;
}
async function scrapeDailyGuide() {
    const stories = [];
    const logs = [];
    try {
        const res = await fetch('https://dailyguidenetwork.com/feed/', {
            headers: {
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
            },
            next: {
                revalidate: 1800
            } // Cache for 30 minutes
        });
        if (!res.ok) {
            logs.push(`DailyGuide RSS Error: ${res.status}`);
            return {
                stories,
                logs
            };
        }
        const xml = await res.text();
        const $ = __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$load$2d$parse$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["load"](xml, {
            xmlMode: true
        });
        const items = $('item').slice(0, 10);
        logs.push(`DailyGuide: Found ${items.length} items`);
        items.each((_, el)=>{
            const title = $(el).find('title').text().trim();
            const link = $(el).find('link').text().trim();
            const pubDate = $(el).find('pubDate').text().trim();
            if (!link) {
                logs.push(`DailyGuide: Skipped item with no link: ${title}`);
                return;
            }
            let timestamp = Date.now();
            let timeDisplay = 'Recent';
            if (pubDate) {
                const parsed = parsePublicationDate(pubDate);
                timestamp = parsed.timestamp;
                timeDisplay = parsed.display;
            }
            // DailyGuide feed usually relies on deep fetch for images as they aren't standard in the RSS item
            // preventing the need for complex content:encoded parsing which is unreliable here.
            stories.push({
                id: `dailyguide-${stories.length + Math.random()}`,
                source: 'DailyGuide',
                title,
                link,
                image: null,
                time: timeDisplay,
                timestamp,
                section: 'News'
            });
        });
    } catch (e) {
        logs.push(`DailyGuide Error: ${e}`);
    }
    return {
        stories,
        logs
    };
}
async function GET() {
    const [ghanaStories, adomStories, peaceStories, joyStories, threeNewsStories, dailyGuideResult] = await Promise.all([
        scrapeGhanaWeb(),
        scrapeAdomOnline(),
        scrapePeaceFM(),
        scrapeMyJoyOnline(),
        scrape3News(),
        scrapeDailyGuide()
    ]);
    const dailyGuideStories = dailyGuideResult.stories;
    const debugLogs = dailyGuideResult.logs;
    let allStories = [
        ...ghanaStories,
        ...adomStories,
        ...peaceStories,
        ...joyStories,
        ...threeNewsStories,
        ...dailyGuideStories
    ];
    // Deduplicate by link
    const uniqueMap = new Map();
    allStories.forEach((s)=>uniqueMap.set(s.link, s));
    allStories = Array.from(uniqueMap.values());
    // sort
    allStories.sort((a, b)=>b.timestamp - a.timestamp);
    // Deep Fetch Metadata for ALL articles to ensure correct images and dates
    // Process in batches to avoid overwhelming the servers
    const batch = allStories.slice(0, 80); // Limit to 80 articles per scrape
    console.log(`Fetching metadata for ${batch.length} articles...`);
    await Promise.all(batch.map(async (story)=>{
        const metadata = await fetchArticleMetadata(story.link, story.source);
        // Always update with metadata from article page if available
        if (metadata.timestamp && metadata.time) {
            story.timestamp = metadata.timestamp;
            story.time = metadata.time;
        }
        if (metadata.image) {
            story.image = metadata.image; // Always use image from article page
        }
        if (metadata.content) {
            story.content = metadata.content;
        }
    }));
    // Final Sort by timestamp descending (newest first)
    allStories.sort((a, b)=>b.timestamp - a.timestamp);
    // Filter out articles without images
    const storiesWithImages = allStories.filter((story)=>story.image !== null && story.image !== '');
    console.log(`Filtered: ${allStories.length} total -> ${storiesWithImages.length} with images`);
    // Save new articles to database (only those with images)
    const newArticlesCount = (0, __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$src$2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["insertArticles"])(storiesWithImages);
    console.log(`Added ${newArticlesCount} new articles to database`);
    // Get all articles from database (limit to 200 most recent)
    const dbArticles = (0, __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$src$2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getAllArticles"])(200);
    const totalCount = (0, __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$src$2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getArticleCount"])();
    // Remove timestamp field from output (keep only the display time)
    const storiesOutput = dbArticles.map(({ timestamp, ...story })=>story);
    const data = {
        generated_at: new Date().toISOString(),
        count: storiesOutput.length,
        total_in_database: totalCount,
        new_articles_added: newArticlesCount,
        stories: storiesOutput,
        debug_logs: debugLogs
    };
    try {
        const publicDir = __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__["default"].join(process.cwd(), 'public');
        if (!__TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["default"].existsSync(publicDir)) __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["default"].mkdirSync(publicDir);
        __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["default"].writeFileSync(__TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__["default"].join(publicDir, 'news-feed.json'), JSON.stringify(data, null, 2));
    } catch (err) {
        console.error('Failed to save content JSON:', err);
    }
    return __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(data);
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__b5907a16._.js.map