{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 196, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/oscar/news/src/app/api/news/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport * as cheerio from 'cheerio';\r\n\r\nexport const dynamic = 'force-dynamic';\r\n\r\ninterface Story {\r\n    id: string;\r\n    source: string;\r\n    title: string;\r\n    link: string;\r\n    image: string | null;\r\n    time: string; // Display text\r\n    timestamp: number; // For sorting\r\n}\r\n\r\nfunction parseTime(timeStr: string): number {\r\n    if (!timeStr) return Date.now();\r\n\r\n    // Try parsing \"January 5, 2026\" or similar\r\n    const date = new Date(timeStr);\r\n    if (!isNaN(date.getTime())) {\r\n        return date.getTime();\r\n    }\r\n\r\n    // Handle \"X hours ago\" if encountered\r\n    const match = timeStr.match(/(\\d+)\\s+(minute|hour|day)s?\\s+ago/i);\r\n    if (match) {\r\n        const val = parseInt(match[1]);\r\n        const unit = match[2].toLowerCase();\r\n        const now = Date.now();\r\n        if (unit.startsWith('minute')) return now - val * 60 * 1000;\r\n        if (unit.startsWith('hour')) return now - val * 60 * 60 * 1000;\r\n        if (unit.startsWith('day')) return now - val * 24 * 60 * 60 * 1000;\r\n    }\r\n\r\n    return Date.now();\r\n}\r\n\r\nasync function scrapeMyJoyOnline(): Promise<Story[]> {\r\n    try {\r\n        const response = await fetch('https://www.myjoyonline.com/', { headers: { 'User-Agent': 'Mozilla/5.0' } });\r\n        const html = await response.text();\r\n        const $ = cheerio.load(html);\r\n        const stories: Story[] = [];\r\n\r\n        // Strategy 1: Top stories and list\r\n        $('.title-summary, .home-post-list-title, .most-popular-list-title').each((i, el) => {\r\n            if (stories.length >= 15) return;\r\n\r\n            const titleEl = $(el).find('h1, h2, h3, h4').first();\r\n            const linkEl = $(el).find('a').first();\r\n\r\n            let title = titleEl.text().trim();\r\n            if (!title) title = linkEl.text().trim();\r\n\r\n            const link = linkEl.attr('href');\r\n\r\n            let container = $(el).closest('.row, .mic-item, .col-lg-3');\r\n            if (container.length === 0) container = $(el).parent().parent();\r\n\r\n            let image = container.find('img').attr('data-src') || container.find('img').attr('src') || null;\r\n\r\n            if (title && link) {\r\n                const fullLink = link.startsWith('/') ? `https://www.myjoyonline.com${link}` : link;\r\n                const fullImage = image && !image.startsWith('http') ? `https://www.myjoyonline.com${image}` : image;\r\n\r\n                // MyJoyOnline homepage doesn't show timestamps. \r\n                // Since these are \"Top Stories\", we assume they are fresh (Today).\r\n                // To vary them slightly for sorting not being clumpy, we can subtract 'i' minutes.\r\n                const timestamp = Date.now() - (i * 60 * 1000); // separate by 1 minute based on position\r\n\r\n                stories.push({\r\n                    id: `joy-${stories.length}`,\r\n                    source: 'MyJoyOnline',\r\n                    title,\r\n                    link: fullLink,\r\n                    image: fullImage || null,\r\n                    time: 'Just now', // We'll recalculate relative time on frontend based on timestamp if we want\r\n                    timestamp\r\n                });\r\n            }\r\n        });\r\n\r\n        return stories;\r\n    } catch (error) {\r\n        console.error('Error scraping MyJoyOnline:', error);\r\n        return [];\r\n    }\r\n}\r\n\r\nasync function scrapeCitiNewsRoom(): Promise<Story[]> {\r\n    try {\r\n        const response = await fetch('https://citinewsroom.com/', { headers: { 'User-Agent': 'Mozilla/5.0' } });\r\n        const html = await response.text();\r\n        const $ = cheerio.load(html);\r\n        const stories: Story[] = [];\r\n\r\n        $('.jeg_post').each((_, el) => {\r\n            if (stories.length >= 15) return;\r\n\r\n            const titleEl = $(el).find('.jeg_post_title a');\r\n            const title = titleEl.text().trim();\r\n            const link = titleEl.attr('href');\r\n\r\n            const imgEl = $(el).find('.jeg_thumb img');\r\n            const image = imgEl.attr('data-src') || imgEl.attr('src') || null;\r\n\r\n            const timeStr = $(el).find('.jeg_meta_date').text().trim(); // e.g., \"January 5, 2026\"\r\n            const timestamp = parseTime(timeStr);\r\n\r\n            if (title && link) {\r\n                stories.push({\r\n                    id: `citi-${stories.length}`,\r\n                    source: 'CitiNewsRoom',\r\n                    title,\r\n                    link,\r\n                    image,\r\n                    time: timeStr || 'Recent',\r\n                    timestamp\r\n                });\r\n            }\r\n        });\r\n\r\n        return stories;\r\n    } catch (error) {\r\n        console.error('Error scraping CitiNewsRoom:', error);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function GET() {\r\n    const [joyStories, citiStories] = await Promise.all([\r\n        scrapeMyJoyOnline(),\r\n        scrapeCitiNewsRoom()\r\n    ]);\r\n\r\n    const allStories = [...joyStories, ...citiStories];\r\n\r\n    // Remove duplicates\r\n    const uniqueStories = Array.from(new Map(allStories.map(s => [s.link, s])).values());\r\n\r\n    // Sort by timestamp descending\r\n    uniqueStories.sort((a, b) => b.timestamp - a.timestamp);\r\n\r\n    return NextResponse.json({ stories: uniqueStories });\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;;;AAEO,MAAM,UAAU;AAYvB,SAAS,UAAU,OAAe;IAC9B,IAAI,CAAC,SAAS,OAAO,KAAK,GAAG;IAE7B,2CAA2C;IAC3C,MAAM,OAAO,IAAI,KAAK;IACtB,IAAI,CAAC,MAAM,KAAK,OAAO,KAAK;QACxB,OAAO,KAAK,OAAO;IACvB;IAEA,sCAAsC;IACtC,MAAM,QAAQ,QAAQ,KAAK,CAAC;IAC5B,IAAI,OAAO;QACP,MAAM,MAAM,SAAS,KAAK,CAAC,EAAE;QAC7B,MAAM,OAAO,KAAK,CAAC,EAAE,CAAC,WAAW;QACjC,MAAM,MAAM,KAAK,GAAG;QACpB,IAAI,KAAK,UAAU,CAAC,WAAW,OAAO,MAAM,MAAM,KAAK;QACvD,IAAI,KAAK,UAAU,CAAC,SAAS,OAAO,MAAM,MAAM,KAAK,KAAK;QAC1D,IAAI,KAAK,UAAU,CAAC,QAAQ,OAAO,MAAM,MAAM,KAAK,KAAK,KAAK;IAClE;IAEA,OAAO,KAAK,GAAG;AACnB;AAEA,eAAe;IACX,IAAI;QACA,MAAM,WAAW,MAAM,MAAM,gCAAgC;YAAE,SAAS;gBAAE,cAAc;YAAc;QAAE;QACxG,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,MAAM,IAAI,yKAAY,CAAC;QACvB,MAAM,UAAmB,EAAE;QAE3B,mCAAmC;QACnC,EAAE,mEAAmE,IAAI,CAAC,CAAC,GAAG;YAC1E,IAAI,QAAQ,MAAM,IAAI,IAAI;YAE1B,MAAM,UAAU,EAAE,IAAI,IAAI,CAAC,kBAAkB,KAAK;YAClD,MAAM,SAAS,EAAE,IAAI,IAAI,CAAC,KAAK,KAAK;YAEpC,IAAI,QAAQ,QAAQ,IAAI,GAAG,IAAI;YAC/B,IAAI,CAAC,OAAO,QAAQ,OAAO,IAAI,GAAG,IAAI;YAEtC,MAAM,OAAO,OAAO,IAAI,CAAC;YAEzB,IAAI,YAAY,EAAE,IAAI,OAAO,CAAC;YAC9B,IAAI,UAAU,MAAM,KAAK,GAAG,YAAY,EAAE,IAAI,MAAM,GAAG,MAAM;YAE7D,IAAI,QAAQ,UAAU,IAAI,CAAC,OAAO,IAAI,CAAC,eAAe,UAAU,IAAI,CAAC,OAAO,IAAI,CAAC,UAAU;YAE3F,IAAI,SAAS,MAAM;gBACf,MAAM,WAAW,KAAK,UAAU,CAAC,OAAO,CAAC,2BAA2B,EAAE,MAAM,GAAG;gBAC/E,MAAM,YAAY,SAAS,CAAC,MAAM,UAAU,CAAC,UAAU,CAAC,2BAA2B,EAAE,OAAO,GAAG;gBAE/F,iDAAiD;gBACjD,mEAAmE;gBACnE,mFAAmF;gBACnF,MAAM,YAAY,KAAK,GAAG,KAAM,IAAI,KAAK,MAAO,yCAAyC;gBAEzF,QAAQ,IAAI,CAAC;oBACT,IAAI,CAAC,IAAI,EAAE,QAAQ,MAAM,EAAE;oBAC3B,QAAQ;oBACR;oBACA,MAAM;oBACN,OAAO,aAAa;oBACpB,MAAM;oBACN;gBACJ;YACJ;QACJ;QAEA,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,EAAE;IACb;AACJ;AAEA,eAAe;IACX,IAAI;QACA,MAAM,WAAW,MAAM,MAAM,6BAA6B;YAAE,SAAS;gBAAE,cAAc;YAAc;QAAE;QACrG,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,MAAM,IAAI,yKAAY,CAAC;QACvB,MAAM,UAAmB,EAAE;QAE3B,EAAE,aAAa,IAAI,CAAC,CAAC,GAAG;YACpB,IAAI,QAAQ,MAAM,IAAI,IAAI;YAE1B,MAAM,UAAU,EAAE,IAAI,IAAI,CAAC;YAC3B,MAAM,QAAQ,QAAQ,IAAI,GAAG,IAAI;YACjC,MAAM,OAAO,QAAQ,IAAI,CAAC;YAE1B,MAAM,QAAQ,EAAE,IAAI,IAAI,CAAC;YACzB,MAAM,QAAQ,MAAM,IAAI,CAAC,eAAe,MAAM,IAAI,CAAC,UAAU;YAE7D,MAAM,UAAU,EAAE,IAAI,IAAI,CAAC,kBAAkB,IAAI,GAAG,IAAI,IAAI,0BAA0B;YACtF,MAAM,YAAY,UAAU;YAE5B,IAAI,SAAS,MAAM;gBACf,QAAQ,IAAI,CAAC;oBACT,IAAI,CAAC,KAAK,EAAE,QAAQ,MAAM,EAAE;oBAC5B,QAAQ;oBACR;oBACA;oBACA;oBACA,MAAM,WAAW;oBACjB;gBACJ;YACJ;QACJ;QAEA,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,EAAE;IACb;AACJ;AAEO,eAAe;IAClB,MAAM,CAAC,YAAY,YAAY,GAAG,MAAM,QAAQ,GAAG,CAAC;QAChD;QACA;KACH;IAED,MAAM,aAAa;WAAI;WAAe;KAAY;IAElD,oBAAoB;IACpB,MAAM,gBAAgB,MAAM,IAAI,CAAC,IAAI,IAAI,WAAW,GAAG,CAAC,CAAA,IAAK;YAAC,EAAE,IAAI;YAAE;SAAE,GAAG,MAAM;IAEjF,+BAA+B;IAC/B,cAAc,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,SAAS,GAAG,EAAE,SAAS;IAEtD,OAAO,wJAAY,CAAC,IAAI,CAAC;QAAE,SAAS;IAAc;AACtD"}}]
}