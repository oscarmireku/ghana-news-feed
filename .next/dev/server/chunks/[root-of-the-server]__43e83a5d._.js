module.exports = [
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/events [external] (events, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}),
"[externals]/https [external] (https, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}),
"[externals]/http [external] (http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}),
"[externals]/net [external] (net, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}),
"[externals]/tls [external] (tls, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}),
"[externals]/crypto [external] (crypto, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/url [external] (url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}),
"[externals]/zlib [external] (zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}),
"[externals]/fs [external] (fs, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}),
"[externals]/path [external] (path, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}),
"[externals]/os [external] (os, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}),
"[externals]/buffer [external] (buffer, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}),
"[project]/news/src/lib/db.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "getAllArticles",
    ()=>getAllArticles,
    "getArticleByLink",
    ()=>getArticleByLink,
    "getArticleCount",
    ()=>getArticleCount,
    "insertArticle",
    ()=>insertArticle,
    "insertArticles",
    ()=>insertArticles,
    "seedArticleTable",
    ()=>seedArticleTable
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f40$vercel$2f$postgres$2f$dist$2f$index$2d$node$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/news/node_modules/@vercel/postgres/dist/index-node.js [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f40$vercel$2f$postgres$2f$dist$2f$chunk$2d$7IR77QAQ$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/news/node_modules/@vercel/postgres/dist/chunk-7IR77QAQ.js [app-route] (ecmascript) <locals>");
;
async function seedArticleTable() {
    await __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f40$vercel$2f$postgres$2f$dist$2f$chunk$2d$7IR77QAQ$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["sql"]`
    CREATE TABLE IF NOT EXISTS articles (
        id TEXT PRIMARY KEY,
        source TEXT NOT NULL,
        title TEXT NOT NULL,
        link TEXT UNIQUE NOT NULL,
        image TEXT,
        time TEXT NOT NULL,
        section TEXT NOT NULL,
        timestamp BIGINT NOT NULL,
        created_at BIGINT NOT NULL,
        content TEXT
    );
    `;
    // Indexes
    await __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f40$vercel$2f$postgres$2f$dist$2f$chunk$2d$7IR77QAQ$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["sql"]`CREATE INDEX IF NOT EXISTS idx_timestamp ON articles(timestamp DESC);`;
    await __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f40$vercel$2f$postgres$2f$dist$2f$chunk$2d$7IR77QAQ$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["sql"]`CREATE INDEX IF NOT EXISTS idx_link ON articles(link);`; // Unique constraint creates index implicitly but this is fine
}
async function insertArticle(article) {
    try {
        const result = await __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f40$vercel$2f$postgres$2f$dist$2f$chunk$2d$7IR77QAQ$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["sql"]`
        INSERT INTO articles (id, source, title, link, image, time, section, timestamp, created_at, content)
        VALUES (${article.id}, ${article.source}, ${article.title}, ${article.link}, ${article.image}, ${article.time}, ${article.section}, ${article.timestamp}, ${Date.now()}, ${article.content || null})
        ON CONFLICT(link) DO UPDATE SET
          time = EXCLUDED.time,
          timestamp = EXCLUDED.timestamp,
          image = EXCLUDED.image,
          title = EXCLUDED.title,
          content = CASE WHEN EXCLUDED.content IS NOT NULL THEN EXCLUDED.content ELSE articles.content END
      `;
        return (result.rowCount ?? 0) > 0;
    } catch (error) {
        console.error('Failed to insert article:', error);
        return false;
    }
}
async function insertArticles(articles) {
    let count = 0;
    // Batch processing could be better, but sequential is safer for now with small batches
    // TODO: Optimise to single INSERT statement for performance if needed
    for (const article of articles){
        const success = await insertArticle(article);
        if (success) count++;
    }
    return count;
}
async function getAllArticles(limit = 100) {
    const { rows } = await __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f40$vercel$2f$postgres$2f$dist$2f$chunk$2d$7IR77QAQ$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["sql"]`
    SELECT id, source, title, link, image, time, section, timestamp, content
    FROM articles
    WHERE image IS NOT NULL AND image != ''
    ORDER BY timestamp DESC
    LIMIT ${limit}
  `;
    // Convert BigInt to number for JS compatibility
    return rows.map((row)=>({
            ...row,
            timestamp: Number(row.timestamp),
            created_at: Number(row.created_at)
        }));
}
async function getArticleByLink(link) {
    const { rows } = await __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f40$vercel$2f$postgres$2f$dist$2f$chunk$2d$7IR77QAQ$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["sql"]`
    SELECT id, source, title, link, image, time, section, timestamp, content
    FROM articles
    WHERE link = ${link}
  `;
    if (rows.length === 0) return undefined;
    const row = rows[0];
    return {
        ...row,
        timestamp: Number(row.timestamp),
        created_at: Number(row.created_at)
    };
}
async function getArticleCount() {
    const { rows } = await __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f40$vercel$2f$postgres$2f$dist$2f$chunk$2d$7IR77QAQ$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["sql"]`SELECT COUNT(*) as count FROM articles`;
    return Number(rows[0].count);
}
}),
"[project]/news/src/app/api/news/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "GET",
    ()=>GET,
    "dynamic",
    ()=>dynamic
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/news/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$src$2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/news/src/lib/db.ts [app-route] (ecmascript)");
;
;
const dynamic = 'force-dynamic';
async function GET() {
    try {
        // Get all articles from database (limit to 200 most recent)
        // These are async calls now with Vercel Postgres
        const dbArticles = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$src$2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getAllArticles"])(200);
        const totalCount = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$src$2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getArticleCount"])();
        // format output
        const storiesOutput = dbArticles.map(({ timestamp, created_at, ...story })=>story);
        const data = {
            generated_at: new Date().toISOString(),
            count: storiesOutput.length,
            total_in_database: totalCount,
            stories: storiesOutput
        };
        return __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(data);
    } catch (e) {
        console.error('Failed to fetch news:', e);
        return __TURBOPACK__imported__module__$5b$project$5d2f$news$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Failed to fetch news',
            details: String(e)
        }, {
            status: 500
        });
    }
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__43e83a5d._.js.map