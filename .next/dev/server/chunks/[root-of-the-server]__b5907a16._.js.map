{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 262, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/oscar/news/src/lib/db.ts"],"sourcesContent":["\r\nimport { sql } from '@vercel/postgres';\r\n\r\nexport interface Article {\r\n  id: string;\r\n  source: string;\r\n  title: string;\r\n  link: string;\r\n  image: string | null;\r\n  time: string;\r\n  section: string;\r\n  timestamp: number;\r\n  created_at?: number;\r\n  content?: string;\r\n}\r\n\r\n// Function to initialize the database (can be called from an endpoint or script)\r\nexport async function seedArticleTable() {\r\n  await sql`\r\n    CREATE TABLE IF NOT EXISTS articles (\r\n        id TEXT PRIMARY KEY,\r\n        source TEXT NOT NULL,\r\n        title TEXT NOT NULL,\r\n        link TEXT UNIQUE NOT NULL,\r\n        image TEXT,\r\n        time TEXT NOT NULL,\r\n        section TEXT NOT NULL,\r\n        timestamp BIGINT NOT NULL,\r\n        created_at BIGINT NOT NULL,\r\n        content TEXT\r\n    );\r\n    `;\r\n\r\n  // Indexes\r\n  await sql`CREATE INDEX IF NOT EXISTS idx_timestamp ON articles(timestamp DESC);`;\r\n  await sql`CREATE INDEX IF NOT EXISTS idx_link ON articles(link);`; // Unique constraint creates index implicitly but this is fine\r\n}\r\n\r\n\r\nexport async function insertArticle(article: Article): Promise<boolean> {\r\n  try {\r\n    const result = await sql`\r\n        INSERT INTO articles (id, source, title, link, image, time, section, timestamp, created_at, content)\r\n        VALUES (${article.id}, ${article.source}, ${article.title}, ${article.link}, ${article.image}, ${article.time}, ${article.section}, ${article.timestamp}, ${Date.now()}, ${article.content || null})\r\n        ON CONFLICT(link) DO UPDATE SET\r\n          time = EXCLUDED.time,\r\n          timestamp = EXCLUDED.timestamp,\r\n          image = EXCLUDED.image,\r\n          title = EXCLUDED.title,\r\n          content = CASE WHEN EXCLUDED.content IS NOT NULL THEN EXCLUDED.content ELSE articles.content END\r\n      `;\r\n    return (result.rowCount ?? 0) > 0;\r\n  } catch (error) {\r\n    console.error('Failed to insert article:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport async function insertArticles(articles: Article[]): Promise<number> {\r\n  let count = 0;\r\n  // Batch processing could be better, but sequential is safer for now with small batches\r\n  // TODO: Optimise to single INSERT statement for performance if needed\r\n  for (const article of articles) {\r\n    const success = await insertArticle(article);\r\n    if (success) count++;\r\n  }\r\n  return count;\r\n}\r\n\r\nexport async function getAllArticles(limit: number = 100): Promise<Article[]> {\r\n  const { rows } = await sql`\r\n    SELECT id, source, title, link, image, time, section, timestamp, content\r\n    FROM articles\r\n    WHERE image IS NOT NULL AND image != ''\r\n    ORDER BY timestamp DESC\r\n    LIMIT ${limit}\r\n  `;\r\n\r\n  // Convert BigInt to number for JS compatibility\r\n  return rows.map(row => ({\r\n    ...row,\r\n    timestamp: Number(row.timestamp),\r\n    created_at: Number(row.created_at)\r\n  })) as Article[];\r\n}\r\n\r\nexport async function getArticleByLink(link: string): Promise<Article | undefined> {\r\n  const { rows } = await sql`\r\n    SELECT id, source, title, link, image, time, section, timestamp, content\r\n    FROM articles\r\n    WHERE link = ${link}\r\n  `;\r\n\r\n  if (rows.length === 0) return undefined;\r\n\r\n  const row = rows[0];\r\n  return {\r\n    ...row,\r\n    timestamp: Number(row.timestamp),\r\n    created_at: Number(row.created_at)\r\n  } as Article;\r\n}\r\n\r\nexport async function getArticleCount(): Promise<number> {\r\n  const { rows } = await sql`SELECT COUNT(*) as count FROM articles`;\r\n  return Number(rows[0].count);\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;AACA;AAAA;;AAgBO,eAAe;IACpB,MAAM,kMAAG,CAAC;;;;;;;;;;;;;IAaR,CAAC;IAEH,UAAU;IACV,MAAM,kMAAG,CAAC,qEAAqE,CAAC;IAChF,MAAM,kMAAG,CAAC,sDAAsD,CAAC,EAAE,8DAA8D;AACnI;AAGO,eAAe,cAAc,OAAgB;IAClD,IAAI;QACF,MAAM,SAAS,MAAM,kMAAG,CAAC;;gBAEb,EAAE,QAAQ,EAAE,CAAC,EAAE,EAAE,QAAQ,MAAM,CAAC,EAAE,EAAE,QAAQ,KAAK,CAAC,EAAE,EAAE,QAAQ,IAAI,CAAC,EAAE,EAAE,QAAQ,KAAK,CAAC,EAAE,EAAE,QAAQ,IAAI,CAAC,EAAE,EAAE,QAAQ,OAAO,CAAC,EAAE,EAAE,QAAQ,SAAS,CAAC,EAAE,EAAE,KAAK,GAAG,GAAG,EAAE,EAAE,QAAQ,OAAO,IAAI,KAAK;;;;;;;MAOrM,CAAC;QACH,OAAO,CAAC,OAAO,QAAQ,IAAI,CAAC,IAAI;IAClC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO;IACT;AACF;AAEO,eAAe,eAAe,QAAmB;IACtD,IAAI,QAAQ;IACZ,uFAAuF;IACvF,sEAAsE;IACtE,KAAK,MAAM,WAAW,SAAU;QAC9B,MAAM,UAAU,MAAM,cAAc;QACpC,IAAI,SAAS;IACf;IACA,OAAO;AACT;AAEO,eAAe,eAAe,QAAgB,GAAG;IACtD,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,kMAAG,CAAC;;;;;UAKnB,EAAE,MAAM;EAChB,CAAC;IAED,gDAAgD;IAChD,OAAO,KAAK,GAAG,CAAC,CAAA,MAAO,CAAC;YACtB,GAAG,GAAG;YACN,WAAW,OAAO,IAAI,SAAS;YAC/B,YAAY,OAAO,IAAI,UAAU;QACnC,CAAC;AACH;AAEO,eAAe,iBAAiB,IAAY;IACjD,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,kMAAG,CAAC;;;iBAGZ,EAAE,KAAK;EACtB,CAAC;IAED,IAAI,KAAK,MAAM,KAAK,GAAG,OAAO;IAE9B,MAAM,MAAM,IAAI,CAAC,EAAE;IACnB,OAAO;QACL,GAAG,GAAG;QACN,WAAW,OAAO,IAAI,SAAS;QAC/B,YAAY,OAAO,IAAI,UAAU;IACnC;AACF;AAEO,eAAe;IACpB,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,kMAAG,CAAC,sCAAsC,CAAC;IAClE,OAAO,OAAO,IAAI,CAAC,EAAE,CAAC,KAAK;AAC7B"}},
    {"offset": {"line": 363, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/oscar/news/src/app/api/news/route.ts"],"sourcesContent":["\r\nimport { NextResponse } from 'next/server';\r\nimport * as cheerio from 'cheerio';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\nimport { insertArticles, getAllArticles, getArticleCount, type Article } from '@/lib/db';\r\n\r\nexport const dynamic = 'force-dynamic';\r\n\r\ninterface Story {\r\n    id: string;\r\n    source: string;\r\n    title: string;\r\n    link: string;\r\n    image: string | null;\r\n    time: string;\r\n    timestamp: number;\r\n    section?: string;\r\n    content?: string;\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n// Helpers\r\n// ---------------------------------------------------------------------------\r\n\r\nfunction normalizeTitle(title: string): string {\r\n    return title.toLowerCase().replace(/[^a-z0-9]/g, '');\r\n}\r\n\r\nfunction resolveUrl(base: string, relative: string): string {\r\n    try {\r\n        return new URL(relative, base).href;\r\n    } catch {\r\n        return relative;\r\n    }\r\n}\r\n\r\n// Parse publication date from various formats\r\nfunction parsePublicationDate(dateStr: string): { timestamp: number; display: string } {\r\n    if (!dateStr || dateStr.trim() === '') {\r\n        return { timestamp: Date.now(), display: 'Recent' };\r\n    }\r\n\r\n    const cleaned = dateStr.trim();\r\n    const d = new Date(cleaned);\r\n\r\n    if (!isNaN(d.getTime())) {\r\n        const timestamp = d.getTime();\r\n        const display = d.toLocaleString('en-US', {\r\n            hour: 'numeric',\r\n            minute: '2-digit',\r\n            month: 'short',\r\n            day: 'numeric'\r\n        });\r\n        return { timestamp, display };\r\n    }\r\n\r\n    // If we can't parse it, return current time\r\n    return { timestamp: Date.now(), display: 'Recent' };\r\n}\r\n\r\n// Fallback: Fetch article page to find og:image and parsing date\r\nasync function fetchArticleMetadata(link: string, source?: string): Promise<{ image: string | null, timestamp?: number, time?: string, content?: string }> {\r\n    try {\r\n        const res = await fetch(link, { headers: { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36' } });\r\n        if (!res.ok) return { image: null };\r\n        const html = await res.text();\r\n        const $ = cheerio.load(html);\r\n\r\n        // Image\r\n        const image = $('meta[property=\"og:image\"]').attr('content') ||\r\n            $('meta[name=\"twitter:image\"]').attr('content') ||\r\n            null;\r\n\r\n        // Date\r\n        let dateStr = $('meta[property=\"og:article:published_time\"]').attr('content') ||\r\n            $('meta[property=\"article:published_time\"]').attr('content') ||\r\n            $('meta[name=\"article:published_time\"]').attr('content') ||\r\n            $('meta[property=\"og:updated_time\"]').attr('content') ||\r\n            $('meta[property=\"article:modified_time\"]').attr('content') ||\r\n            $('meta[itemprop=\"datePublished\"]').attr('content') ||\r\n            $('meta[name=\"pubdate\"]').attr('content') ||\r\n            $('#date').text() ||\r\n            $('time').first().attr('datetime');\r\n\r\n        let timestamp: number | undefined;\r\n        let time: string | undefined;\r\n\r\n        if (dateStr) {\r\n            const parsed = parsePublicationDate(dateStr);\r\n            if (parsed.display !== 'Recent') {\r\n                timestamp = parsed.timestamp;\r\n                time = parsed.display;\r\n            }\r\n        }\r\n\r\n        // Content Extraction\r\n        let contentSelector = '';\r\n        if (source === '3News') contentSelector = '.prose';\r\n        else if (source === 'GhanaWeb') contentSelector = '#medsection1, .article-content-area';\r\n        else if (source === 'AdomOnline') contentSelector = '.td-post-content';\r\n        else if (source === 'MyJoyOnline') contentSelector = '#article-text';\r\n\r\n        // Generic fallback selectors\r\n        if (!contentSelector) {\r\n            contentSelector = '.entry-content, .article-body, .post-content, .content-wrapper, article';\r\n        }\r\n\r\n        let contentEl = $(contentSelector).first();\r\n        if (contentEl.length === 0 && source === 'GhanaWeb') {\r\n            // Fallback for GhanaWeb\r\n            contentEl = $('p').parent().filter((i, el) => $(el).find('p').length > 3).first();\r\n        }\r\n\r\n        let content = '';\r\n        if (contentEl.length) {\r\n            // Remove unwanted elements\r\n            contentEl.find('script, style, iframe, .related-posts, .ads, .ad, [class*=\"ad-\"], [id*=\"ad-\"]').remove();\r\n\r\n            // Get paragraphs\r\n            const paragraphs: string[] = [];\r\n            contentEl.find('p').each((_, el) => {\r\n                const text = $(el).text().trim();\r\n                if (text.length > 20) { // Filter out short snippets/captions\r\n                    paragraphs.push(`<p>${text}</p>`);\r\n                }\r\n            });\r\n            content = paragraphs.join('');\r\n        }\r\n\r\n        return { image, timestamp, time, content };\r\n    } catch {\r\n        return { image: null };\r\n    }\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n// Source: GhanaWeb (Scrape Sections)\r\n// ---------------------------------------------------------------------------\r\nasync function scrapeGhanaWeb(): Promise<Story[]> {\r\n    const sections = [\r\n        { name: 'News', url: 'https://www.ghanaweb.com/GhanaHomePage/NewsArchive/' },\r\n        { name: 'Sports', url: 'https://www.ghanaweb.com/GhanaHomePage/SportsArchive/' },\r\n        { name: 'Business', url: 'https://www.ghanaweb.com/GhanaHomePage/business/' }\r\n    ];\r\n\r\n    const stories: Story[] = [];\r\n    const seenLinks = new Set<string>();\r\n\r\n    await Promise.all(sections.map(async (sec) => {\r\n        try {\r\n            const res = await fetch(sec.url, { headers: { 'User-Agent': 'Mozilla/5.0' } });\r\n            const html = await res.text();\r\n            const $ = cheerio.load(html);\r\n\r\n            // Strategy: \r\n            // 1. Try known containers (desktop view)\r\n            // 2. Fallback: Find ALL links that look like articles in this section\r\n            let candidates = $('.inner-lead, .sub-menu-list__news li, .news_listing .inner, #leads .inner, .news-list li');\r\n\r\n            if (candidates.length === 0) {\r\n                // Fallback: finding any link containing 'Article' or looking like a news path\r\n                // GhanaWeb articles: /GhanaHomePage/NewsArchive/artikel.php?ID=... or similar slugs\r\n                candidates = $('a[href*=\"artikel.php\"], a[href*=\"/NewsArchive/\"], a[href*=\"/SportsArchive/\"], a[href*=\"/business/\"]');\r\n            }\r\n\r\n            candidates.slice(0, 10).each((_, el) => {\r\n                const a = $(el).is('a') ? $(el) : $(el).find('a').first();\r\n                const link = a.attr('href');\r\n                let title = a.attr('title') || a.text().trim();\r\n\r\n                if (!title || title.length < 5) {\r\n                    title = $(el).find('h2, h3, h4, p').text().trim();\r\n                }\r\n\r\n                let image = $(el).find('img').attr('src');\r\n                if (!image) {\r\n                    // Check parent for image\r\n                    image = $(el).closest('div, li').find('img').attr('src');\r\n                }\r\n\r\n                // Extract publication date - GhanaWeb typically has date in .date, .time, or time elements\r\n                let dateStr = $(el).find('.date, .time, time, .published, .post-date').first().text().trim();\r\n                if (!dateStr) {\r\n                    // Check for datetime attribute in time element\r\n                    dateStr = $(el).find('time').attr('datetime') || '';\r\n                }\r\n                const { timestamp, display } = parsePublicationDate(dateStr);\r\n\r\n                if (link && title && title.length > 10 && !link.includes('javascript') && !link.includes('#')) {\r\n                    const fullLink = resolveUrl('https://www.ghanaweb.com', link);\r\n                    if (seenLinks.has(fullLink)) return;\r\n                    seenLinks.add(fullLink);\r\n\r\n                    if (image) image = resolveUrl('https://cdn.ghanaweb.com', image);\r\n\r\n                    stories.push({\r\n                        id: `gw-${stories.length + Math.random()}`,\r\n                        source: 'GhanaWeb',\r\n                        title,\r\n                        link: fullLink,\r\n                        image: image || null,\r\n                        time: display,\r\n                        timestamp,\r\n                        section: sec.name\r\n                    });\r\n                }\r\n            });\r\n        } catch (e) {\r\n            console.error(`GhanaWeb ${sec.name} Error:`, e);\r\n        }\r\n    }));\r\n\r\n    return stories;\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n// Source: AdomOnline (RSS Sections)\r\n// ---------------------------------------------------------------------------\r\nasync function scrapeAdomOnline(): Promise<Story[]> {\r\n    const feeds = [\r\n        { name: 'News', url: 'https://www.adomonline.com/category/news/feed/' },\r\n        { name: 'Sports', url: 'https://www.adomonline.com/category/sports/feed/' },\r\n        { name: 'Business', url: 'https://www.adomonline.com/category/business/feed/' }\r\n    ];\r\n\r\n    const stories: Story[] = [];\r\n    const seenLinks = new Set<string>();\r\n\r\n    await Promise.all(feeds.map(async (feed) => {\r\n        try {\r\n            const res = await fetch(feed.url, { headers: { 'User-Agent': 'Mozilla/5.0' } });\r\n            const xml = await res.text();\r\n            const $ = cheerio.load(xml, { xmlMode: true });\r\n\r\n            $('item').slice(0, 5).each((_, el) => {\r\n                const title = $(el).find('title').text().trim();\r\n                const link = $(el).find('link').text().trim();\r\n                const pubDate = $(el).find('pubDate').text().trim();\r\n\r\n                if (seenLinks.has(link)) return;\r\n                seenLinks.add(link);\r\n\r\n                let timestamp = Date.now();\r\n                let timeDisplay = 'Recent';\r\n                if (pubDate) {\r\n                    const d = new Date(pubDate);\r\n                    if (!isNaN(d.getTime())) {\r\n                        timestamp = d.getTime();\r\n                        timeDisplay = d.toLocaleString('en-US', { hour: 'numeric', minute: '2-digit', month: 'short', day: 'numeric' });\r\n                    }\r\n                }\r\n\r\n                let image = $(el).find('media\\\\:content').attr('url') ||\r\n                    $(el).find('media\\\\:thumbnail').attr('url');\r\n\r\n                if (!image) {\r\n                    const content = $(el).find('content\\\\:encoded').text();\r\n                    const match = content.match(/src=\"([^\"]+)\"/);\r\n                    if (match) image = match[1];\r\n                }\r\n\r\n                stories.push({\r\n                    id: `adom-${stories.length + Math.random()}`,\r\n                    source: 'AdomOnline',\r\n                    title,\r\n                    link,\r\n                    image: image || null,\r\n                    time: timeDisplay,\r\n                    timestamp,\r\n                    section: feed.name\r\n                });\r\n            });\r\n        } catch (e) {\r\n            console.error(`AdomOnline ${feed.name} Error:`, e);\r\n        }\r\n    }));\r\n\r\n    return stories;\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n// Source: PeaceFM (HTML Scrape Sections)\r\n// ---------------------------------------------------------------------------\r\nasync function scrapePeaceFM(): Promise<Story[]> {\r\n    const sections = [\r\n        { name: 'News', url: 'https://www.peacefmonline.com/pages/local/' },\r\n        { name: 'Sports', url: 'https://www.peacefmonline.com/pages/sports/' },\r\n        { name: 'Business', url: 'https://www.peacefmonline.com/pages/business/' }\r\n    ];\r\n\r\n    const stories: Story[] = [];\r\n    const seenLinks = new Set<string>();\r\n\r\n    await Promise.all(sections.map(async (sec) => {\r\n        try {\r\n            const res = await fetch(sec.url, { headers: { 'User-Agent': 'Mozilla/5.0' } });\r\n            const html = await res.text();\r\n            const $ = cheerio.load(html);\r\n\r\n            // Try generic containers\r\n            let candidates = $('.jeg_post, .post-item, .article-item, .jeg_pl_md_box, .content-wrapper .item');\r\n\r\n            // If empty, brute force search for article links in main area. \r\n            // PeaceFM links start with /pages/ or /article/\r\n            if (candidates.length === 0) {\r\n                candidates = $('a[href^=\"/article/\"], a[href*=\"/pages/news/\"], a[href*=\"/pages/sports/\"], a[href*=\"/pages/business/\"]');\r\n            }\r\n\r\n            candidates.slice(0, 10).each((_, el) => {\r\n                let a = $(el).is('a') ? $(el) : $(el).find('a').first();\r\n                const titleLink = $(el).find('.jeg_post_title a, h2 a, h3 a').first();\r\n                if (titleLink.length) a = titleLink;\r\n\r\n                const link = a.attr('href');\r\n                let title = a.text().trim();\r\n\r\n                // Image\r\n                let image = $(el).find('img').attr('data-src') || $(el).find('img').attr('src');\r\n                if (!image) {\r\n                    image = $(el).closest('div, li').find('img').first().attr('src');\r\n                }\r\n\r\n                // Extract publication date - PeaceFM typically has date in .jeg_meta_date or time elements\r\n                let dateStr = $(el).find('.jeg_meta_date, .date, time, .published, .post-date').first().text().trim();\r\n                if (!dateStr) {\r\n                    dateStr = $(el).find('time').attr('datetime') || '';\r\n                }\r\n                const { timestamp, display } = parsePublicationDate(dateStr);\r\n\r\n                // Filter out non-article links if brute forcing (basic heuristic)\r\n                // PeaceFM usually contains 'pages' or 'article'\r\n                if (link && (link.includes('/article/') || link.includes('/pages/')) && title && title.length > 10) {\r\n                    const fullLink = resolveUrl('https://www.peacefmonline.com', link);\r\n                    if (seenLinks.has(fullLink)) return;\r\n                    seenLinks.add(fullLink);\r\n\r\n                    if (image) image = resolveUrl('https://www.peacefmonline.com', image);\r\n\r\n                    stories.push({\r\n                        id: `peace-${stories.length + Math.random()}`,\r\n                        source: 'PeaceFM',\r\n                        title,\r\n                        link: fullLink,\r\n                        image: image || null,\r\n                        time: display,\r\n                        timestamp,\r\n                        section: sec.name\r\n                    });\r\n                }\r\n            });\r\n        } catch (e) {\r\n            console.error(`PeaceFM ${sec.name} Error:`, e);\r\n        }\r\n    }));\r\n\r\n    return stories;\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n// Source: MyJoyOnline (HTML Scrape Sections)\r\n// ---------------------------------------------------------------------------\r\nasync function scrapeMyJoyOnline(): Promise<Story[]> {\r\n    const sections = [\r\n        { name: 'News', url: 'https://www.myjoyonline.com/news/' },\r\n        { name: 'Sports', url: 'https://www.myjoyonline.com/sports/' },\r\n        { name: 'Business', url: 'https://www.myjoyonline.com/business/' }\r\n    ];\r\n\r\n    const stories: Story[] = [];\r\n    const seenLinks = new Set<string>();\r\n\r\n    await Promise.all(sections.map(async (sec) => {\r\n        try {\r\n            const res = await fetch(sec.url, { headers: { 'User-Agent': 'Mozilla/5.0' } });\r\n            const html = await res.text();\r\n            const $ = cheerio.load(html);\r\n\r\n            // Structure: divs containing .bgposition (image link) and .title (text link)\r\n            // or just iterate .col-xs-6, .col-lg-3 containers\r\n            const containers = $('.news-main-list .col-lg-3, .col-lg-6, .home-section-story-list li, .main-listing-article');\r\n\r\n            containers.slice(0, 10).each((_, el) => {\r\n                const imgLink = $(el).find('a.bgposition');\r\n                const titleLink = $(el).find('h3 a, h4 a, .title a').first();\r\n                const fallbackLink = $(el).find('a').first();\r\n\r\n                const finalLink = titleLink.length ? titleLink : (imgLink.length ? imgLink : fallbackLink);\r\n\r\n                const link = finalLink.attr('href');\r\n                let title = finalLink.text().trim();\r\n                // If title was empty from link, try finding header text\r\n                if (!title) title = $(el).find('h1, h2, h3, h4').text().trim();\r\n\r\n                let image = $(el).find('img').attr('data-src') || $(el).find('img').attr('src');\r\n                // Extract from style if bgposition\r\n                if (!image && imgLink.attr('style')) {\r\n                    const match = imgLink.attr('style')?.match(/url\\(['\"]?([^'\"]+)['\"]?\\)/);\r\n                    if (match) image = match[1];\r\n                }\r\n\r\n                // Extract publication date - MyJoyOnline typically has date in .date, time, or .post-date\r\n                let dateStr = $(el).find('.date, time, .post-date, .published, .entry-date').first().text().trim();\r\n                if (!dateStr) {\r\n                    dateStr = $(el).find('time').attr('datetime') || '';\r\n                }\r\n                const { timestamp, display } = parsePublicationDate(dateStr);\r\n\r\n                if (link && title && title.length > 10) {\r\n                    const fullLink = resolveUrl('https://www.myjoyonline.com', link);\r\n                    if (seenLinks.has(fullLink)) return;\r\n                    seenLinks.add(fullLink);\r\n\r\n                    stories.push({\r\n                        id: `joy-${stories.length + Math.random()}`,\r\n                        source: 'MyJoyOnline',\r\n                        title,\r\n                        link: fullLink,\r\n                        image: image || null,\r\n                        time: display,\r\n                        timestamp,\r\n                        section: sec.name\r\n                    });\r\n                }\r\n            });\r\n        } catch (e) {\r\n            console.error(`MyJoyOnline ${sec.name} Error:`, e);\r\n        }\r\n    }));\r\n\r\n    return stories;\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n// Source: 3News (RSS Feed)\r\n// ---------------------------------------------------------------------------\r\nasync function scrape3News(): Promise<Story[]> {\r\n    const stories: Story[] = [];\r\n    const seenLinks = new Set<string>();\r\n\r\n    try {\r\n        const res = await fetch('https://3news.com/news/feed.xml', {\r\n            headers: { 'User-Agent': 'Mozilla/5.0' }\r\n        });\r\n        if (!res.ok) throw new Error(`3News RSS failed: ${res.status}`);\r\n\r\n        const xml = await res.text();\r\n        const $ = cheerio.load(xml, { xmlMode: true });\r\n\r\n        $('item').slice(0, 10).each((_, el) => {\r\n            const title = $(el).find('title').text().trim();\r\n            const link = $(el).find('link').text().trim();\r\n            const pubDate = $(el).find('pubDate').text().trim();\r\n\r\n            if (seenLinks.has(link)) return;\r\n            seenLinks.add(link);\r\n\r\n            let timestamp = Date.now();\r\n            let timeDisplay = 'Recent';\r\n            if (pubDate) {\r\n                const parsed = parsePublicationDate(pubDate);\r\n                timestamp = parsed.timestamp;\r\n                timeDisplay = parsed.display;\r\n            }\r\n\r\n            // Extract image from media:content or description\r\n            let image = $(el).find('media\\\\:content').attr('url') ||\r\n                $(el).find('media\\\\:thumbnail').attr('url');\r\n\r\n            if (!image) {\r\n                const description = $(el).find('description').text();\r\n                const match = description.match(/src=\"([^\"]+)\"/);\r\n                if (match) image = match[1];\r\n            }\r\n\r\n            stories.push({\r\n                id: `3news-${stories.length + Math.random()}`,\r\n                source: '3News',\r\n                title,\r\n                link,\r\n                image: image || null,\r\n                time: timeDisplay,\r\n                timestamp,\r\n                section: 'News'\r\n            });\r\n        });\r\n    } catch (e) {\r\n        console.error('3News Error:', e);\r\n    }\r\n\r\n    return stories;\r\n}\r\n\r\nasync function scrapeDailyGuide(): Promise<{ stories: Article[], logs: string[] }> {\r\n    const stories: Article[] = [];\r\n    const logs: string[] = [];\r\n    try {\r\n        const res = await fetch('https://dailyguidenetwork.com/feed/', {\r\n            headers: {\r\n                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'\r\n            },\r\n            next: { revalidate: 1800 } // Cache for 30 minutes\r\n        });\r\n\r\n        if (!res.ok) {\r\n            logs.push(`DailyGuide RSS Error: ${res.status}`);\r\n            return { stories, logs };\r\n        }\r\n\r\n        const xml = await res.text();\r\n        const $ = cheerio.load(xml, { xmlMode: true });\r\n\r\n        const items = $('item').slice(0, 10);\r\n        logs.push(`DailyGuide: Found ${items.length} items`);\r\n\r\n        items.each((_, el) => {\r\n            const title = $(el).find('title').text().trim();\r\n            const link = $(el).find('link').text().trim();\r\n            const pubDate = $(el).find('pubDate').text().trim();\r\n\r\n            if (!link) {\r\n                logs.push(`DailyGuide: Skipped item with no link: ${title}`);\r\n                return;\r\n            }\r\n\r\n            let timestamp = Date.now();\r\n            let timeDisplay = 'Recent';\r\n            if (pubDate) {\r\n                const parsed = parsePublicationDate(pubDate);\r\n                timestamp = parsed.timestamp;\r\n                timeDisplay = parsed.display;\r\n            }\r\n\r\n            // DailyGuide feed usually relies on deep fetch for images as they aren't standard in the RSS item\r\n            // preventing the need for complex content:encoded parsing which is unreliable here.\r\n\r\n            stories.push({\r\n                id: `dailyguide-${stories.length + Math.random()}`,\r\n                source: 'DailyGuide',\r\n                title,\r\n                link,\r\n                image: null, // Will be deepened fetched\r\n                time: timeDisplay,\r\n                timestamp,\r\n                section: 'News'\r\n            });\r\n        });\r\n    } catch (e) {\r\n        logs.push(`DailyGuide Error: ${e}`);\r\n    }\r\n\r\n    return { stories, logs };\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n// Main Handler\r\n// ---------------------------------------------------------------------------\r\n\r\nexport async function GET() {\r\n    const [ghanaStories, adomStories, peaceStories, joyStories, threeNewsStories, dailyGuideResult] = await Promise.all([\r\n        scrapeGhanaWeb(),\r\n        scrapeAdomOnline(),\r\n        scrapePeaceFM(),\r\n        scrapeMyJoyOnline(),\r\n        scrape3News(),\r\n        scrapeDailyGuide()\r\n    ]);\r\n\r\n    const dailyGuideStories = dailyGuideResult.stories;\r\n    const debugLogs = dailyGuideResult.logs;\r\n\r\n    let allStories = [...ghanaStories, ...adomStories, ...peaceStories, ...joyStories, ...threeNewsStories, ...dailyGuideStories];\r\n\r\n    // Deduplicate by link\r\n    const uniqueMap = new Map();\r\n    allStories.forEach(s => uniqueMap.set(s.link, s));\r\n    allStories = Array.from(uniqueMap.values());\r\n\r\n    // sort\r\n    allStories.sort((a, b) => b.timestamp - a.timestamp);\r\n\r\n    // Deep Fetch Metadata for ALL articles to ensure correct images and dates\r\n    // Process in batches to avoid overwhelming the servers\r\n    const batch = allStories.slice(0, 80); // Limit to 80 articles per scrape\r\n\r\n    console.log(`Fetching metadata for ${batch.length} articles...`);\r\n\r\n    await Promise.all(batch.map(async (story) => {\r\n        const metadata = await fetchArticleMetadata(story.link, story.source);\r\n\r\n        // Always update with metadata from article page if available\r\n        if (metadata.timestamp && metadata.time) {\r\n            story.timestamp = metadata.timestamp;\r\n            story.time = metadata.time;\r\n        }\r\n        if (metadata.image) {\r\n            story.image = metadata.image; // Always use image from article page\r\n        }\r\n        if (metadata.content) {\r\n            story.content = metadata.content;\r\n        }\r\n    }));\r\n\r\n    // Final Sort by timestamp descending (newest first)\r\n    allStories.sort((a, b) => b.timestamp - a.timestamp);\r\n\r\n    // Filter out articles without images\r\n    const storiesWithImages = allStories.filter(story => story.image !== null && story.image !== '');\r\n    console.log(`Filtered: ${allStories.length} total -> ${storiesWithImages.length} with images`);\r\n\r\n    // Save new articles to database (only those with images)\r\n    const newArticlesCount = insertArticles(storiesWithImages as Article[]);\r\n    console.log(`Added ${newArticlesCount} new articles to database`);\r\n\r\n    // Get all articles from database (limit to 200 most recent)\r\n    const dbArticles = getAllArticles(200);\r\n    const totalCount = getArticleCount();\r\n\r\n    // Remove timestamp field from output (keep only the display time)\r\n    const storiesOutput = dbArticles.map(({ timestamp, ...story }) => story);\r\n\r\n    const data = {\r\n        generated_at: new Date().toISOString(),\r\n        count: storiesOutput.length,\r\n        total_in_database: totalCount,\r\n        new_articles_added: newArticlesCount,\r\n        stories: storiesOutput,\r\n        debug_logs: debugLogs\r\n    };\r\n\r\n    try {\r\n        const publicDir = path.join(process.cwd(), 'public');\r\n        if (!fs.existsSync(publicDir)) fs.mkdirSync(publicDir);\r\n        fs.writeFileSync(path.join(publicDir, 'news-feed.json'), JSON.stringify(data, null, 2));\r\n    } catch (err) {\r\n        console.error('Failed to save content JSON:', err);\r\n    }\r\n\r\n    return NextResponse.json(data);\r\n}\r\n"],"names":[],"mappings":"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"}}]
}