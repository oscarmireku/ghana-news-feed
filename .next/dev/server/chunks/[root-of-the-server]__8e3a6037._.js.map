{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 30, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/oscar/news/src/pages/api/update-json.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next';\r\nimport { createClient } from '@libsql/client';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\n\r\nconst url = process.env.TURSO_DATABASE_URL!;\r\nconst authToken = process.env.TURSO_AUTH_TOKEN;\r\n\r\nconst db = createClient({ url, authToken });\r\n\r\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\r\n    if (req.method !== 'POST') {\r\n        return res.status(405).json({ error: 'Method not allowed' });\r\n    }\r\n\r\n    try {\r\n        // Fetch latest news from database (Including GhanaWeb again)\r\n        const result = await db.execute({\r\n            sql: \"SELECT * FROM articles ORDER BY timestamp DESC LIMIT 100\",\r\n            args: []\r\n        });\r\n\r\n        const stories = result.rows\r\n            // .filter(row => row.source !== 'GhanaWeb')  // Already filtered in SQL\r\n            .map(row => ({\r\n                id: row.id,\r\n                source: row.source,\r\n                title: row.title,\r\n                link: row.link,\r\n                image: row.image,\r\n                time: row.time,\r\n                section: row.section,\r\n                content: row.content\r\n            }));\r\n\r\n        const data = {\r\n            generated_at: new Date().toISOString(),\r\n            count: stories.length,\r\n            total_in_database: stories.length,\r\n            new_articles_added: 0,\r\n            stories\r\n        };\r\n\r\n        // Write to public/news-feed.json\r\n        const filePath = path.join(process.cwd(), 'public', 'news-feed.json');\r\n        fs.writeFileSync(filePath, JSON.stringify(data, null, 2));\r\n\r\n        res.status(200).json({ success: true, message: 'news-feed.json updated', count: stories.length });\r\n    } catch (error: any) {\r\n        console.error('Error updating news-feed.json:', error);\r\n        res.status(500).json({ error: error.message });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;;;;;;;;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,kBAAkB;AAC1C,MAAM,YAAY,QAAQ,GAAG,CAAC,gBAAgB;AAE9C,MAAM,KAAK,IAAA,qNAAY,EAAC;IAAE;IAAK;AAAU;AAE1B,eAAe,QAAQ,GAAmB,EAAE,GAAoB;IAC3E,IAAI,IAAI,MAAM,KAAK,QAAQ;QACvB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAqB;IAC9D;IAEA,IAAI;QACA,6DAA6D;QAC7D,MAAM,SAAS,MAAM,GAAG,OAAO,CAAC;YAC5B,KAAK;YACL,MAAM,EAAE;QACZ;QAEA,MAAM,UAAU,OAAO,IAAI,AACvB,wEAAwE;SACvE,GAAG,CAAC,CAAA,MAAO,CAAC;gBACT,IAAI,IAAI,EAAE;gBACV,QAAQ,IAAI,MAAM;gBAClB,OAAO,IAAI,KAAK;gBAChB,MAAM,IAAI,IAAI;gBACd,OAAO,IAAI,KAAK;gBAChB,MAAM,IAAI,IAAI;gBACd,SAAS,IAAI,OAAO;gBACpB,SAAS,IAAI,OAAO;YACxB,CAAC;QAEL,MAAM,OAAO;YACT,cAAc,IAAI,OAAO,WAAW;YACpC,OAAO,QAAQ,MAAM;YACrB,mBAAmB,QAAQ,MAAM;YACjC,oBAAoB;YACpB;QACJ;QAEA,iCAAiC;QACjC,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU;QACpD,wGAAE,CAAC,aAAa,CAAC,UAAU,KAAK,SAAS,CAAC,MAAM,MAAM;QAEtD,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS;YAAM,SAAS;YAA0B,OAAO,QAAQ,MAAM;QAAC;IACnG,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,kCAAkC;QAChD,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC;IAChD;AACJ"}}]
}