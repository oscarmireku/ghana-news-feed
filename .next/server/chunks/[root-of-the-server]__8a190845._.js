module.exports=[45213,e=>e.a(async(t,a)=>{try{let t=await e.y("cheerio-bcbc60a8db27f2ce");e.n(t),a()}catch(e){a(e)}},!0),93542,(e,t,a)=>{t.exports=e.x("@mozilla/readability-7615fc00d4f88072",()=>require("@mozilla/readability-7615fc00d4f88072"))},94572,(e,t,a)=>{t.exports=e.x("jsdom-812a7fdd85b64540",()=>require("jsdom-812a7fdd85b64540"))},68906,(e,t,a)=>{t.exports=e.x("rss-parser-c9f5e681c07162a7",()=>require("rss-parser-c9f5e681c07162a7"))},46489,e=>{"use strict";let t=new(e.i(68906)).default({timeout:1e4,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"},customFields:{item:[["media:content","mediaContent"],["media:thumbnail","mediaThumbnail"],["enclosure","enclosure"],["dc:creator","creator"],["content:encoded","contentEncoded"]]}});async function a(e,i,n="General"){try{return(await t.parseURL(e)).items.map(e=>({title:e.title||"No Title",link:e.link||"#",pubDate:e.pubDate||new Date().toISOString(),isoDate:e.isoDate,content:e.contentEncoded||e.content||e.contentSnippet||"",contentSnippet:e.contentSnippet||"",source:i,category:n,imageUrl:function(e){if(e.mediaContent&&e.mediaContent.$&&e.mediaContent.$.url)return e.mediaContent.$.url;if(e.mediaThumbnail&&e.mediaThumbnail.$&&e.mediaThumbnail.$.url)return e.mediaThumbnail.$.url;if(e.enclosure&&e.enclosure.url)return e.enclosure.url;let t=(e.contentEncoded||e.content||"").match(/<img[^>]+src="([^">]+)"/);if(t)return t[1]}(e)}))}catch(t){return console.error(`Error fetching RSS feed for ${i} (${e}):`,t),[]}}e.s(["fetchRSS",()=>a])},4454,e=>e.a(async(t,a)=>{try{var i=e.i(45213),n=e.i(93542),r=e.i(94572),s=e.i(97457),o=e.i(46489),l=t([i,s]);function c(e,t){try{return new URL(t,e).href}catch{return t}}function m(e){if(!e||""===e.trim())return{timestamp:Date.now(),display:"Recent"};let t=e.trim(),a=new Date(t);if(!isNaN(a.getTime())){let e=a.getTime(),t=a.toLocaleString("en-US",{hour:"numeric",minute:"2-digit",month:"short",day:"numeric"});return{timestamp:e,display:t}}return{timestamp:Date.now(),display:"Recent"}}function u(e){let t=Math.floor((Date.now()-e)/1e3),a=t/31536e3;return a>1?Math.floor(a)+" years ago":(a=t/2592e3)>1?Math.floor(a)+" months ago":(a=t/86400)>1?Math.floor(a)+" days ago":(a=t/3600)>1?Math.floor(a)+" hours ago":(a=t/60)>1?Math.floor(a)+" minutes ago":Math.floor(t)+" seconds ago"}async function d(e,t){try{let a,s;if("PeaceFM"===t||e.includes("peacefmonline.com")){let t=e.match(/\/(\d+)-/);if(t){let e=t[1],a=`https://articles-engine.peacefmonline.com/v1/articles/${e}`,i=await fetch(a,{headers:{"User-Agent":"Mozilla/5.0"}});if(i.ok){let e=await i.json();if("success"===e.status&&e.data){let t=e.data;return{image:t.main_photo?.photo_url||null,timestamp:new Date(t.created_at).getTime(),time:u(new Date(t.created_at).getTime()),content:t.main_description}}}}}let o=await fetch(e,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"}});if(!o.ok)return{image:null};let l=await o.text(),c=i.load(l),d=c('meta[property="og:image"]').attr("content")||c('meta[name="twitter:image"]').attr("content")||null,h=c('meta[property="og:article:published_time"]').attr("content")||c('meta[property="article:published_time"]').attr("content")||c('meta[name="article:published_time"]').attr("content")||c('meta[property="og:updated_time"]').attr("content")||c('meta[property="article:modified_time"]').attr("content")||c('meta[itemprop="datePublished"]').attr("content")||c('meta[name="pubdate"]').attr("content")||c("#date").text()||c("time").first().attr("datetime");if(h||"MyJoyOnline"!==t||(h=c(".post-date, .entry-date, .published, .article-date").first().text().trim()||c(".meta-info time").text().trim()||c('span[class*="date"]').first().text().trim()),"GhanaWeb"===t){let e=c('meta[property="article:published_time"]').attr("content")||c('meta[property="og:article:published_time"]').attr("content")||c('meta[itemprop="datePublished"]').attr("content");e&&(h=e)}if(h){let e=m(h);"Recent"!==e.display&&(a=e.timestamp,s=e.display)}let p="";if("3News"===t){let e=c(".article-content").first();if(e.length>0){e.find(".gam-ad-slot, .ad-viewability-tracker, ins.adsbygoogle, script, iframe, style").remove(),e.find("div, button, a").each((e,t)=>{let a=c(t).text().toLowerCase();(a.includes("remove ads")||a.includes("privacy manager")||a.includes("tap here to add 3news"))&&c(t).remove()});let t=[];e.find("p").each((e,a)=>{let i=c(a).text().trim();!(i.length>5)||i.toLowerCase().includes("read also")||i.toLowerCase().includes("read more")||t.push(`<p>${i}</p>`)}),p=t.join("")}}if(!p){let e="";"GhanaWeb"===t?e="#medsection1, .article-content-area":"AdomOnline"===t?e=".td-post-content":"MyJoyOnline"===t?e="#article-text":"Yen"===t||"yen.com.gh"===t?e=".js-article-body, .post-content":("Pulse"===t||"pulse.com.gh"===t)&&(e="article, .max-w-\\[620px\\], .article-content"),e||(e=".entry-content, .article-body, .post-content, .content-wrapper, article");let a=c(e).first();if(0===a.length&&"GhanaWeb"===t&&(a=c("p").parent().filter((e,t)=>c(t).find("p").length>3).first()),a.length){a.find('script, style, iframe, .related-posts, .ads, .ad, [class*="ad-"], [id*="ad-"]').remove();let e=[];a.find("p").each((t,a)=>{let i=c(a).text().trim();i.length>20&&e.push(`<p>${i}</p>`)}),p=e.join("")}}if(!p||p.length<100){let t=new r.JSDOM(l,{url:e}),a=new n.Readability(t.window.document).parse();a&&a.content&&(p=a.content)}return{image:d,timestamp:a,time:s,content:p}}catch{return{image:null}}}async function h(){let e=[],t=new Set;return await Promise.all([{name:"News",url:"https://www.ghanaweb.com/GhanaHomePage/NewsArchive/"},{name:"Sports",url:"https://www.ghanaweb.com/GhanaHomePage/SportsArchive/"},{name:"Business",url:"https://www.ghanaweb.com/GhanaHomePage/business/"}].map(async a=>{try{let n=await fetch(a.url,{headers:{"User-Agent":"Mozilla/5.0"}}),r=await n.text(),s=i.load(r),o=s(".inner-lead, .sub-menu-list__news li, .news_listing .inner, #leads .inner, .news-list li");0===o.length&&(o=s('a[href*="artikel.php"], a[href*="/NewsArchive/"], a[href*="/SportsArchive/"], a[href*="/business/"]')),o.slice(0,10).each((i,n)=>{let r=s(n).is("a")?s(n):s(n).find("a").first(),o=r.attr("href"),l=r.attr("title")||r.text().trim();(!l||l.length<5)&&(l=s(n).find("h2, h3, h4, p").text().trim());let u=s(n).find("img").attr("src");u||(u=s(n).closest("div, li").find("img").attr("src"));let d=s(n).find(".date, .time, time, .published, .post-date").first().text().trim();d||(d=s(n).find("time").attr("datetime")||"");let{timestamp:h,display:p}=m(d),g=["Home - News","Home - Business","Home - Sports","Home-Business","Business archive","News Archive","Sports Archive","Photo Archives","Archive","Category:","Section:","More News","More Stories","View All","Latest News","Top Stories"].some(e=>l.toLowerCase().trim()===e.toLowerCase()||l.toLowerCase().includes(e.toLowerCase())),w=o?.includes("artikel.php?ID=")||/\/\d{7,}-/.test(o||""),f=u?.toLowerCase().endsWith(".svg");if(o&&l&&l.length>10&&!o.includes("javascript")&&!o.includes("#")&&!g&&w&&!f){let i=c("https://www.ghanaweb.com",o);if(t.has(i))return;t.add(i),u&&(u=c("https://cdn.ghanaweb.com",u)),e.push({id:`gw-${e.length+Math.random()}`,source:"GhanaWeb",title:l,link:i,image:u||null,time:p,timestamp:h,section:a.name})}})}catch(e){console.error(`GhanaWeb ${a.name} Error:`,e)}})),e}async function p(){try{return(await (0,o.fetchRSS)("https://www.adomonline.com/feed/","AdomOnline","News")).map(e=>({id:`adom-${Math.random().toString(36).substr(2,9)}`,source:"AdomOnline",title:e.title,link:e.link,image:e.imageUrl||null,time:u(new Date(e.pubDate).getTime()),timestamp:new Date(e.pubDate).getTime(),section:"News",content:e.content}))}catch(e){return console.error("AdomOnline Error:",e),[]}}async function g(){try{let e=await fetch("https://articles-engine.peacefmonline.com/v1/articles?limit=30",{headers:{"User-Agent":"Mozilla/5.0"}});if(!e.ok)return[];let t=await e.json();if("success"!==t.status||!t.data)return[];return t.data.map(e=>{let t=e.section?.section_location||"local",a=e.category?.category_location||"news",i=`https://www.peacefmonline.com/pages/${t}/${a}/${e.slug}`;return{id:`peace-${e.article_id}`,source:"PeaceFM",title:e.main_title,link:i,image:e.main_photo?.photo_url||null,time:u(new Date(e.created_at).getTime()),section:e.section?.section_name||"News",timestamp:new Date(e.created_at).getTime()}}).filter(e=>e.title&&e.link)}catch(e){return console.error("Error scraping PeaceFM:",e),[]}}async function w(){try{return(await (0,o.fetchRSS)("https://www.myjoyonline.com/feed/","MyJoyOnline","News")).map(e=>({id:`joy-${Math.random().toString(36).substr(2,9)}`,source:"MyJoyOnline",title:e.title,link:e.link,image:e.imageUrl||null,time:u(new Date(e.pubDate).getTime()),timestamp:new Date(e.pubDate).getTime(),section:"News",content:e.content}))}catch(e){return console.error("MyJoyOnline Error:",e),[]}}async function f(){try{return(await (0,o.fetchRSS)("https://3news.com/feed/","3News","News")).map(e=>({id:`3news-${Math.random().toString(36).substr(2,9)}`,source:"3News",title:e.title,link:e.link,image:e.imageUrl||null,time:u(new Date(e.pubDate).getTime()),timestamp:new Date(e.pubDate).getTime(),section:"News",content:e.content}))}catch(e){return console.error("3News Error:",e),[]}}async function y(){let e=[],t=[];try{let a=await (0,o.fetchRSS)("https://dailyguidenetwork.com/feed/","DailyGuide","News");a.forEach(t=>{e.push({id:`dailyguide-${Math.random().toString(36).substr(2,9)}`,source:"DailyGuide",title:t.title,link:t.link,image:t.imageUrl||null,time:u(new Date(t.pubDate).getTime()),timestamp:new Date(t.pubDate).getTime(),section:"News",content:t.content})}),t.push(`DailyGuide: Found ${a.length} items`)}catch(e){t.push(`DailyGuide Error: ${e}`)}return{stories:e,logs:t}}async function b(){let e=[],t=new Set;return await Promise.all([{name:"News",url:"https://citinewsroom.com/news/"},{name:"Business",url:"https://citinewsroom.com/category/business/"},{name:"Politics",url:"https://citinewsroom.com/category/politics/"},{name:"Regional",url:"https://citinewsroom.com/category/regional-news/"},{name:"Sports",url:"https://citisportsonline.com/"}].map(async a=>{try{let n=await fetch(a.url,{headers:{"User-Agent":"Mozilla/5.0"}}),r=await n.text(),s=i.load(r);s(".jeg_post").slice(0,15).each((i,n)=>{let r=s(n).find(".jeg_post_title a").first(),o=r.attr("href"),l=r.text().trim(),c=s(n).find(".jeg_thumb img").attr("data-src")||s(n).find(".jeg_thumb img").attr("src");if(!c){let e=s(n).find(".jeg_thumb img").attr("data-srcset");if(e){let t=e.split(",");t.length>0&&(c=t[t.length-1].trim().split(" ")[0])}}let u=s(n).find(".jeg_meta_date").text().trim(),{timestamp:d,display:h}=m(u);if(o&&l&&l.length>5&&!t.has(o)){t.add(o);let i=s(n).find(".jeg_post_category span a").text().trim();if(i||(i=a.name),i.toLowerCase().includes("entertainment")||o.toLowerCase().includes("/entertainment/"))return;e.push({id:`citi-${e.length+Math.random()}`,source:"CitiNewsRoom",title:l,link:o,image:c||null,time:h,timestamp:d,section:i})}})}catch(e){console.error(`CitiNewsRoom ${a.name} Error:`,e)}})),e}[i,s]=l.then?(await l)():l;let v=[{source:"yen.com.gh",url:"https://yen.com.gh/rss/all.rss",section:"News"},{source:"pulse.com.gh",url:"https://www.pulse.com.gh/rss-articles.xml",section:"News"},{source:"GNA",url:"https://gna.org.gh/feed/",section:"News"},{source:"Graphic Online",url:"https://www.graphic.com.gh/news/general-news?format=feed",section:"News"},{source:"Ghanaian Times",url:"https://www.ghanaiantimes.com.gh/feed/",section:"News"},{source:"Starr FM",url:"https://starrfm.com.gh/feed/",section:"News"},{source:"News Ghana",url:"https://newsghana.com.gh/feed/",section:"News"},{source:"The B&FT",url:"https://thebftonline.com/feed/",section:"Business"},{source:"Atinka Online",url:"https://atinkaonline.com/feed/",section:"News"},{source:"Asaase Radio",url:"https://asaaseradio.com/feed/",section:"News"},{source:"The Herald",url:"https://theheraldghana.com/feed/",section:"News"},{source:"The Chronicle",url:"https://thechronicle.com.gh/feed/",section:"News"},{source:"GhPage",url:"https://ghpage.com/feed/",section:"Entertainment"},{source:"Ameyaw Debrah",url:"https://ameyawdebrah.com/feed/",section:"Entertainment"},{source:"YFM Ghana",url:"https://yfmghana.com/feed/",section:"Entertainment"},{source:"Happy Ghana",url:"https://www.happyghana.com/feed/",section:"News"},{source:"GhanaSoccerNet",url:"https://ghanasoccernet.com/feed",section:"Sports"}];async function S(){let e=[];return await Promise.all(v.map(async t=>{try{(await (0,o.fetchRSS)(t.url,t.source,t.section)).forEach(a=>{e.push({id:`${t.source.toLowerCase().replace(/\s+/g,"")}-${Math.random().toString(36).substr(2,9)}`,source:t.source,title:a.title,link:a.link,image:a.imageUrl||null,time:u(new Date(a.pubDate).getTime()),timestamp:new Date(a.pubDate).getTime(),section:t.section,content:a.content})})}catch(e){console.error(`Generic RSS Error (${t.source}):`,e)}})),e}async function N(e,t){let a=e.headers.authorization;if(process.env.CRON_SECRET&&a!==`Bearer ${process.env.CRON_SECRET}`)return t.status(401).json({success:!1,message:"Unauthorized"});console.log("CRON: Starting scrape...");let[i,n,r,o,l,c,m,u]=await Promise.all([h(),p(),g(),w(),f(),y(),b(),S()]),N=c.stories,v=[...i,...n,...r,...o,...l,...N,...m,...u],D=new Map;v.forEach(e=>D.set(e.link,e)),v=Array.from(D.values());let $=[],R=0;for(let e of v)!function(e,t,a=.7){return t.some(t=>(function(e,t){let a=e=>e.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim(),i=a(e),n=a(t);if(i===n)return 1;let r=new Set(i.split(" ").filter(e=>e.length>2)),s=new Set(n.split(" ").filter(e=>e.length>2));if(0===r.size||0===s.size)return 0;let o=new Set([...r].filter(e=>s.has(e))),l=new Set([...r,...s]);return o.size/l.size})(e.title,t.title)>=a)}(e,$,.75)?$.push(e):R++;v=$,console.log(`CRON: Removed ${R} duplicate stories based on title similarity`),v.sort((e,t)=>t.timestamp-e.timestamp);let x=await (0,s.getAllLinks)();console.log(`CRON: Database has ${x.size} existing articles`);let _=v.filter(e=>!x.has(e.link));console.log(`CRON: Found ${_.length} new articles (skipped ${v.length-_.length} existing)`);let C=_.slice(0,20);console.log(`CRON: Fetching metadata for ${C.length} new articles...`),await Promise.all(C.map(async e=>{let t=await d(e.link,e.source);t.timestamp&&t.time&&(e.timestamp=t.timestamp,e.time=t.time),t.image&&(e.image=t.image),t.content&&(e.content=t.content)})),v.sort((e,t)=>t.timestamp-e.timestamp),v.forEach(e=>{e.image&&(e.image=e.image.trim())});let M=Date.now()-6048e5,A=v.filter(e=>e.timestamp>=M),T=v.length-A.length;T>0&&console.log(`CRON: Filtered out ${T} articles older than 7 days`);let k=A.filter(e=>null!==e.image&&""!==e.image&&!e.image.toLowerCase().endsWith(".svg"));console.log(`CRON: Filtered -> ${k.length} articles to insert`);let E=await (0,s.insertArticles)(k);console.log(`CRON: Added ${E} new articles`);let P=await (0,s.deleteInvalidArticles)(),G=await (0,s.deleteOldArticles)(500);console.log(`CRON: Cleanup -> Removed ${P} invalid and ${G} old articles.`),t.status(200).json({success:!0,added:E,cleaned_invalid:P,cleaned_old:G})}e.s(["config",0,{maxDuration:60},"default",()=>N]),a()}catch(e){a(e)}},!1),9648,e=>e.a(async(t,a)=>{try{var i=e.i(4589),n=e.i(69442),r=e.i(16967),s=e.i(79109),o=e.i(4454),l=e.i(71295),c=e.i(54580),m=e.i(1551),u=t([o]);[o]=u.then?(await u)():u;let h=(0,s.hoist)(o,"default"),p=(0,s.hoist)(o,"config"),g=new r.PagesAPIRouteModule({definition:{kind:n.RouteKind.PAGES_API,page:"/api/cron",pathname:"/api/cron",bundlePath:"",filename:""},userland:o,distDir:".next",relativeProjectDir:""});async function d(e,t,a){g.isDev&&(0,m.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/cron";n=n.replace(/\/index$/,"")||"/";let r=await g.prepare(e,t,{srcPage:n});if(!r){t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve());return}let{query:s,params:o,prerenderManifest:u,routerServerContext:d}=r;try{let a=e.method||"GET",i=(0,l.getTracer)(),r=i.getActiveScopeSpan(),m=g.instrumentationOnRequestError.bind(g),h=async r=>g.render(e,t,{query:{...s,...o},params:o,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:u.preview,propagateError:!1,dev:g.isDev,page:"/api/cron",internalRevalidate:null==d?void 0:d.revalidate,onError:(...t)=>m(e,...t)}).finally(()=>{if(!r)return;r.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=i.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=e.get("next.route");if(s){let e=`${a} ${s}`;r.setAttributes({"next.route":s,"http.route":s,"next.span_name":e}),r.updateName(e)}else r.updateName(`${a} ${n}`)});r?await h(r):await i.withPropagatedContext(e.headers,()=>i.trace(c.BaseServerSpan.handleRequest,{spanName:`${a} ${n}`,kind:l.SpanKind.SERVER,attributes:{"http.method":a,"http.target":e.url}},h))}catch(e){if(g.isDev)throw e;(0,i.sendError)(t,500,"Internal Server Error")}finally{null==a.waitUntil||a.waitUntil.call(a,Promise.resolve())}}e.s(["config",0,p,"default",0,h,"handler",()=>d]),a()}catch(e){a(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__8a190845._.js.map